<!--

    Copyright (C) 2013 Inera AB (http://www.inera.se)

    This file is part of Inera Certificate Modules (http://code.google.com/p/inera-certificate-modules).

    Inera Certificate Modules is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    Inera Certificate Modules is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->

<a id="top"></a>
<div class="container-fluid" id="edit-ts-diabetes">
  <div class="row">
    <div class="col-md-12 webcert-col webcert-col-single">

      <div wc-print-header title-id="ts-diabetes.label.certtitle" print-message-id="print.label.draft" intygs-id="cert.id"></div>
      <div class="print-show">
        <label class="control-label">{{cert.intygMetadata.patient.fullstandigtNamn}} - {{cert.intygMetadata.patient.personId}}</label>
      </div>

      <div class="header-fix-top print-hide">
        <div class="header-wrapper" ng-hide="widgetState.collapsedHeader" ng-animate="'menucollapse'">
          <div id="wcHeader" wc-header default-active="index"></div>
        </div>

        <div ng-hide="widgetState.activeErrorMessageKey">
          <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
               show-content="widgetState.doneLoading">

            <div class="header-fix-panel">
              <div class="header-fix-top-expand">
                <div class="header-fix-top-expand-wrapper">
                  <button class="btn btn-link" ng-click="toggleHeader()"><span
                      ng-if="widgetState.collapsedHeader">Visa</span><span
                      ng-if="!widgetState.collapsedHeader">Dölj</span> meny
                  </button>
                </div>
              </div>
              <a class="backlink-icon" href="/web/dashboard#/create/choose-cert-type/index"
                 title="Tillbaka till Skriv intyg"></a>

              <h1 style="display: inline-block; margin-right: 20px;"><span message
                                                                           key="ts-diabetes.label.certtitle"></span>
              </h1>

              <div class="inline-block">
                <label class="control-label">{{cert.intygMetadata.patient.fullstandigtNamn}} - {{cert.intygMetadata.patient.personId}}</label>
              </div>
              <div class="form-group buttonbar">
                <button id="spara-utkast" class="btn btn-info" ng-click="save()" ng-if="!isSigned">Spara utkast</button>
                <button id="ta-bort-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned"
                        ng-click="discard()"><i class="glyphicon glyphicon-trash"></i>
                </button>
                <button id="skriv-ut-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned" ng-click="print()">
                  Skriv ut
                </button>
                <button class="btn btn-default btn-secondary" ng-if="!widgetState.showComplete && !isComplete"
                        ng-click="toggleShowComplete()" title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">Visa vad som saknas
                </button>
                <button class="btn btn-default btn-secondary" ng-if="widgetState.showComplete && !isComplete"
                        ng-click="toggleShowComplete()" title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">Dölj vad som saknas
                </button>
              </div>
              <!-- Just in case -->
              <div id="certificate-is-sent-to-it-message-text" ng-show="isSigned"><span message key="draft.status.signed"></span>
              </div>
              <!-- complete -->
              <div ng-show="certForm.$pristine && isComplete && !isSigned"><span id="intyget-sparat-meddelande" message key="draft.status.draft_complete"></span>
              </div>
              <!-- incomplete -->
              <div ng-show="certForm.$pristine && !isComplete"><span message key="draft.status.draft_incomplete"></span>
              </div>
              <!-- form changed -->
              <div ng-show="certForm.$dirty"><span message key="draft.status.changed"></span></div>

            </div>
          </div>
        </div>
      </div>
      <!-- top end -->

      <!-- Total fail error messages -->
      <div class="cert-error-panel" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey">
        <div class="alert alert-danger">
          <span message key="{{widgetState.activeErrorMessageKey}}"></span>
        </div>
      </div>

      <!-- TS-DIABETES -->
      <div class="edit-form" ng-class="{'collapsed' : widgetState.collapsedHeader}">

        <form name="certForm" novalidate autocomplete="off">
          <div ng-hide="widgetState.activeErrorMessageKey">

            <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
                 show-content="widgetState.doneLoading">

              <div class="alert alert-danger" ng-show="widgetState.showComplete && !isComplete"
                   style="margin-right: 20px">
                <h3><span message key="draft.saknar-uppgifter"></span></h3>
                <ul>
                  <li ng-repeat="message in validationMessages"><span message key="{{message.message}}"></span></li>
                </ul>
              </div>

              <div id="certificate" class="row certificate">
                <div class="col-md-12 cert-body">

                  <div wc-field field-label="ts-bas.label.patientadress" id="patientForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.patient">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.patient"><span message
                                                                                           key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <div class="form-horizontal">
                      <div class="form-group">
                        <label class="col-xs-3 control-label"><span message key="ts-bas.form.postadress"></span></label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control input-full" id="patientPostadress"
                                 name="cert.intygMetadata.patient.postadress" ng-model="cert.intygMetadata.patient.postadress" maxlength="50" wc-focus-on="firstInput">
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="col-xs-3 control-label"><span message key="ts-bas.form.postnummer"></span></label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control input-5" id="patientPostnummer"
                                 name="cert.intygMetadata.patient.postnummer" ng-model="cert.intygMetadata.patient.postnummer" maxlength="6">
                        </div>
                      </div>

                      <div class="form-group">
                        <label class="col-xs-3 control-label"><span message key="ts-bas.form.postort"></span></label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control" id="patientPostort" name="cert.intygMetadata.patient.postort"
                                 ng-model="cert.intygMetadata.patient.postort" maxlength="25">
                        </div>
                      </div>
                    </div>
                  </div>

                  <div wc-field field-label="ts-diabetes.label.intygavser"
                       field-help-text="ts-diabetes.helptext.intyget-avser" id="intygetAvserForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.intygavser">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.intygavser"><span message
                                                                                              key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <div class="form-group clearfix">
                      <label class="checkbox checkbox-columns col-md-2"
                             ng-repeat="typ in cert.intygAvser.korkortstyp track by $index"><input
                          id="typcheck{{$index}}" name="typcheck{{$index}}" type="checkbox" ng-model="typ.selected">
                        <span message key="ts-diabetes.label.korkort.{{typ.type}}"></span></label>
                    </div>
                  </div>

                  <div wc-field field-label="ts-diabetes.label.identitet" id="identitetForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.identitet">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.identitet"><span message
                                                                                             key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <div class="form-group clearfix">
                      <label class="radio checkbox-columns col-md-6" ng-repeat="v in form.identity"><input
                          id="identity{{$index}}" name="identity{{$index}}" type="radio" value="{{v.id}}"
                          ng-model="cert.vardkontakt.idkontroll">
                        {{v.label}}</label>
                    </div>
                    <div class="alert alert-info">
                      <span message key="ts-diabetes.helptext.identitet-styrkt-genom.id-kort"></span><br>
                      <span message key="ts-diabetes.helptext.identitet-styrkt-genom.foretags-tjanstekort"></span><br>
                      <span message key="ts-diabetes.helptext.identitet-styrkt-genom.forsakran-enl18kap4"></span><br>
                      <span message key="ts-diabetes.helptext.identitet-styrkt-genom.pass"></span><br>
                    </div>
                  </div>
                  <div class="alert alert-info">
                    <span message key="ts-diabetes.helptext.lakaren-ska-uppmarksamma"></span>
                  </div>

                  <!-- 1. Allmänt -->
                  <div wc-field field-label="ts-diabetes.label.allmant" class="print-pagebreak-after" id="allmantForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.diabetes">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.diabetes"><span message
                                                                                            key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <div class="form-group">
                      <label for="diabetesyear"> Vilket år ställdes diagnosen diabetes?</label>
                      <div class="controls">
                        <input id="diabetesyear" class="form-control input-year" type="text" maxlength="4"
                               ng-model="cert.diabetes.observationsperiod" />
                      </div>
                    </div>
                    <div class="form-group">
                      Patienten har diabetes {{cert.diabetes.diabetesTyp}}
                      <label class="radio"><input name="diabetestyp" type="radio" value="DIABETES_TYP_1"
                                                  ng-model="cert.diabetes.diabetestyp">Typ 1</label>
                      <label class="radio"><input name="diabetestyp" type="radio" value="DIABETES_TYP_2"
                                                  ng-model="cert.diabetes.diabetestyp">Typ 2</label>
                    </div>
                    <div class="form-group">
                      Behandling
                      <label class="checkbox"><input id="diabetestreat1" name="diabetestreat1" type="checkbox"
                                                     ng-model="cert.diabetes.endastKost">
                        <span message key="ts-diabetes.label.diabetes.behandling.endast-kost"></span>
                      </label>
                      <label class="checkbox"><input id="diabetestreat2" name="diabetestreat2" type="checkbox"
                                                     ng-model="cert.diabetes.tabletter">
                        <span message key="ts-diabetes.label.diabetes.behandling.tabletter"></span>
                      </label>
                      <label class="checkbox"><input id="diabetestreat3" name="diabetestreat3" type="checkbox"
                                                     ng-model="cert.diabetes.insulin">
                        <span message key="ts-diabetes.label.diabetes.behandling.insulin"></span>
                      </label>
                      <div class="form-group indent" data-ng-show="cert.diabetes.insulin">
                        <label for="insulinBehandlingsperiod"><span message
                                                                    key="ts-diabetes.label.diabetes.behandling.insulin-period"></span></label>
                        <div class="controls">
                          <input id="insulinBehandlingsperiod" class="form-control input-year"
                                 name="insulinBehandlingsperiod" type="text"
                                 ng-model="cert.diabetes.insulinBehandlingsperiod" maxlength="4" />
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label for="annanBehandlingBeskrivning"><span message
                                                                    key="ts-diabetes.label.diabetes.behandling.annan-beskrivning"></span></label>
                      <div class="controls">
                        <input id="annanBehandlingBeskrivning" class="form-control input-full"
                               name="annanBehandlingBeskrivning" type="text"
                               ng-model="cert.diabetes.annanBehandlingBeskrivning" wc-maxlength
                               ng-trim="false" maxlength="53" />
                      </div>
                    </div>
                  </div>

                  <!-- 2. Hypoglykemier (lågt blodsocker)-->
                  <div wc-field field-label="ts-diabetes.label.hypoglykemier" id="hypoglykemierForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.hypoglykemier">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.hypoglykemier"><span message
                                                                                                 key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <table class="table table-form">
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="hypoay" name="hypoa" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.kunskapOmAtgarder"></td>
                        <td><input id="hypoan" name="hypoa" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.kunskapOmAtgarder"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.har-patient-kannedom"></span></td>
                      </tr>
                      <tr>
                        <td><input id="hypoby" name="hypob" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.teckenNedsattHjarnfunktion"></td>
                        <td><input id="hypobn" name="hypob" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.teckenNedsattHjarnfunktion"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.tecken-nedsatt-hjarnfunktion"></span>
                          <p>(Om nej behöver c-e inte besvaras)</p></td>
                      </tr>
                      <tr data-ng-show="cert.hypoglykemier.teckenNedsattHjarnfunktion">
                        <td><input id="hypocy" name="hypoc" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.saknarFormagaKannaVarningstecken"></td>
                        <td><input id="hypocn" name="hypoc" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.saknarFormagaKannaVarningstecken"></td>
                        <td><span message
                                  key="ts-diabetes.label.hypoglykemier.saknar-formaga-kanna-varningstecken"></span></td>
                      </tr>
                      <tr data-ng-show="cert.hypoglykemier.teckenNedsattHjarnfunktion">
                        <td><input id="hypody" name="hypod" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.allvarligForekomst"></td>
                        <td><input id="hypodn" name="hypod" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.allvarligForekomst"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst"></span>

                          <div class="controls" ng-show="cert.hypoglykemier.allvarligForekomst == true">
                            <label for="allvarligForekomstBeskrivning">
                              <span message
                                    key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst.beskrivning"></span>
                            </label>
                            <input id="allvarligForekomstBeskrivning" class="form-control input-full"
                                   name="allvarligForekomstBeskrivning" type="text"
                                   ng-model="cert.hypoglykemier.allvarligForekomstBeskrivning" wc-maxlength
                                   ng-trim="false" maxlength="40" />
                          </div>
                        </td>
                      </tr>
                      <tr data-ng-show="cert.hypoglykemier.teckenNedsattHjarnfunktion">
                        <td><input id="hypoey" name="hypoe" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.allvarligForekomstTrafiken"></td>
                        <td><input id="hypoen" name="hypoe" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.allvarligForekomstTrafiken"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken"></span>
                          <div class="controls" ng-show="cert.hypoglykemier.allvarligForekomstTrafiken == true">
                            <label for="allvarligForekomstTrafikBeskrivning">
                              <span message
                                    key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken.beskrivning"></span>
                            </label>
                            <input id="allvarligForekomstTrafikBeskrivning" class="form-control input-full"
                                   name="allvarligForekomstTrafikBeskrivning" type="text"
                                   ng-model="cert.hypoglykemier.allvarligForekomstTrafikBeskrivning" wc-maxlength
                                   ng-trim="false" maxlength="40" />
                          </div>
                        </td>
                      </tr>
                      <tr data-ng-show="form.korkortd">
                        <td></td>
                        <td></td>
                        <td><h5 class="inline-heading">För innehav av behörigheterna C1, C1E, C, CE, D1, D1E, D, DE och
                          taxiförarlegitimation ska även fråga f-g besvaras</h5></td>
                      </tr>
                      <tr data-ng-show="form.korkortd">
                        <td><input id="hypofy" name="hypof" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.egenkontrollBlodsocker"></td>
                        <td><input id="hypofn" name="hypof" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.egenkontrollBlodsocker"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.egenkontroll-blodsocker"></span></td>
                      </tr>
                      <tr data-ng-show="form.korkortd">
                        <td><input id="hypogy" name="hypog" type="radio" ng-value="true"
                                   ng-model="cert.hypoglykemier.allvarligForekomstVakenTid"></td>
                        <td><input id="hypogn" name="hypog" type="radio" ng-value="false"
                                   ng-model="cert.hypoglykemier.allvarligForekomstVakenTid"></td>
                        <td><span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-vaken-tid"></span>
                          <div class="controls form-inline webcert-top-padding-section" data-ng-show="cert.hypoglykemier.allvarligForekomstVakenTid">
                            <label class="control-label"><span message key="common.when"></span></label>
                            <span wc-date-picker-field target-model="cert.hypoglykemier.allvarligForekomstVakenTidObservationstid"
                                  dom-id="allvarligForekomstVakenTidObservationstid"
                                  invalid="false"></span>
                            <p>(Fyll i åååå-mm-dd)</p>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <!-- 3. Synintyg -->
                  <div wc-field field-label="ts-diabetes.label.synintyg" field-has-errors="testerror" ng-form
                       name="synForm" id="synForm">

                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.syn">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.syn"><span message
                                                                                             key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td></td>
                        <td></td>
                        <td><h5>Alternativ 1</h5></td>
                      </tr>
                      <tr>
                        <td></td>
                        <td></td>
                        <td>Vid synnedsättningar av betydelse för innehavet krävs ögonläkarintyg. Detta gäller vid
                          proliferativ retinopati, genomgången laserbehandling av retinopati, signifikant makulaödem
                          eller
                          vid annan ögonsjukdom samt om ögonbottenfoto saknas.
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="synay" name="syna" type="radio" ng-value="true"
                                   ng-model="cert.syn.separatOgonlakarintyg"></td>
                        <td><input id="synan" name="syna" type="radio" ng-value="false"
                                   ng-model="cert.syn.separatOgonlakarintyg"></td>
                        <td><span message key="ts-diabetes.label.syn.separat-ogonlakarintyg"></span></td>
                      </tr>
                      <tr data-ng-hide="cert.syn.separatOgonlakarintyg">
                        <td></td>
                        <td></td>
                        <td><h5 class="inline-heading">Alternativ 2: (frågorna b-d besvaras)</h5></td>
                      </tr>
                      <tr data-ng-hide="cert.syn.separatOgonlakarintyg">
                        <td></td>
                        <td></td>
                        <td>Om ögonläkarintyg inte krävs kan behandlande specialistkompetent läkare med god kännedom om
                          patientens sjukdom här avge intyg om synfunktionen.
                        </td>
                      </tr>
                      <tr data-ng-hide="cert.syn.separatOgonlakarintyg">
                        <td><input id="synby" name="synb" type="radio" ng-value="true"
                                   ng-model="cert.syn.synfaltsprovningUtanAnmarkning"></td>
                        <td><input id="synbn" name="synb" type="radio" ng-value="false"
                                   ng-model="cert.syn.synfaltsprovningUtanAnmarkning"></td>
                        <td>
                          <span message key="ts-diabetes.label.syn.synfaltsprovning-utan-anmarkning"></span>
                        </td>
                      </tr>
                      <tr data-ng-hide="cert.syn.separatOgonlakarintyg">
                        <td></td>
                        <td></td>
                        <td>
                          <p><span message key="ts-diabetes.label.syn.synskarpa"></span></p>

                          <div class="alert alert-info">
                            <span message key="ts-diabetes.helptext.synfunktioner.synskarpa"></span>
                          </div>

                          <table class="table table-form">
                            <tr>
                              <th></th>
                              <th>Utan korrektion <span wc-enable-tooltip
                                                        field-help-text="ts-diabetes.helptext.synfunktioner.utan-korrektion"></span>
                              </th>
                              <th>Med korrektion <span wc-enable-tooltip
                                                       field-help-text="ts-diabetes.helptext.synfunktioner.med-korrektion"></span>
                              </th>
                            </tr>
                            <tr>
                              <td>Höger öga</td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synHogerOgaUtanKorrektion" ng-model="cert.syn.hoger.utanKorrektion" maxlength="4"></td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synHogerOgaMedKorrektion" ng-model="cert.syn.hoger.medKorrektion" maxlength="4"></td>
                            </tr>
                            <tr>
                              <td>Vänster öga</td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synVansterOgaUtanKorrektion" ng-model="cert.syn.vanster.utanKorrektion" maxlength="4"></td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synVansterOgaMedKorrektion" ng-model="cert.syn.vanster.medKorrektion" maxlength="4"></td>
                            </tr>
                            <tr>
                              <td>Binokulärt</td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synBinokulartUtanKorrektion" ng-model="cert.syn.binokulart.utanKorrektion" maxlength="4"></td>
                              <td><input type="text" class="form-control small-decimal" wc-decimal-number wc-decimal-max-numbers="2"
                                         id="synBinokulartMedKorrektion" ng-model="cert.syn.binokulart.medKorrektion" maxlength="4"></td>
                            </tr>
                          </table>
                      </tr>
                      <tr data-ng-hide="cert.syn.separatOgonlakarintyg">
                        <td><input id="syndy" name="synd" type="radio" ng-value="true" ng-model="cert.syn.diplopi">
                        </td>
                        <td><input id="syndn" name="synd" type="radio" ng-value="false" ng-model="cert.syn.diplopi">
                        </td>
                        <td>d) Förekommer dubbelseende?</td>
                      </tr>
                    </table>
                  </div>

                  <!-- 4. Bedömning -->
                  <div wc-field field-label="ts-diabetes.label.bedomning" field-help-text="ts-diabetes.helptext.intyget-avser" id="bedomningForm">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.bedomning">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.bedomning"><span message
                                                                                             key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <table class="table table-form">
                      <tr>
                        <td></td>
                        <td></td>
                        <td>
                          <p>Patienten uppfyller kraven enligt 6 kap. i Transportstyrelsens föreskrifter och allmänna
                            råd om
                            medicinska krav för innehav av körkort m.m. (TSFS 2010:125, senast ändrade genom TSFS
                            2013:2).
                            Föreskrivna krav på läkarens specialistkompetens vid diabetessjukdom anges i 17 kap.
                            Se <a href="http://www.transportstyrelsen.se" target="_blank">www.transportstyrelsen.se <img
                                src="/img/link_icon.png"></a>. Därefter "Väg" och "Trafikmedicin".</p>

                          <div class="form-group">
                            <label class="radio"><input name="behorighet" type="radio" ng-value="true"
                                                        ng-model="form.behorighet"> Någon av följande
                              behörigheter</label>
                            <div class="form-group clearfix indent" data-ng-show="form.behorighet">
                              <label class="checkbox checkbox-columns col-md-2"
                                     ng-repeat="typ in cert.bedomning.korkortstyp track by $index"><input
                                  id="korkortstyp{{$index}}" name="korkortstyp{{$index}}" type="checkbox"
                                  ng-model="typ.selected"> <span message
                                                                 key="ts-diabetes.label.korkort.{{typ.type}}"></span></label>
                            </div>
                            <label class="radio"><input name="behorighet" type="radio" ng-value="false"
                                                        ng-model="form.behorighet"> Kan inte ta ställning</label>
                          </div>
                        </td>
                      </tr>
                      <tr data-ng-show="form.korkortd">
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr data-ng-show="form.korkortd">
                        <td><input id="bedomningy" name="bedomning" type="radio" ng-value="true"
                                   ng-model="cert.bedomning.lamplighetInnehaBehorighet"></td>
                        <td><input id="bedomningn" name="bedomning" type="radio" ng-value="false"
                                   ng-model="cert.bedomning.lamplighetInnehaBehorighet"></td>
                        <td><span message key="ts-diabetes.label.bedomning.lamplighet-inneha"></span></td>
                      </tr>
                    </table>
                  </div>

                  <!-- Övriga upplysningar -->
                  <div wc-field field-label="ts-diabetes.label.empty">
                    <h5>Övriga upplysningar och kommentarer</h5>
                    <textarea class="form-control" ng-model="cert.kommentar" wc-maxlength ng-trim="false"
                              id="kommentar" maxlength="189" rows="4"></textarea>
                  </div>

                  <!-- Specialistkompetens -->
                  <div wc-field field-label="ts-diabetes.label.empty">
                    <h5>Patienten bör före ärendets avgörande undersökas av läkare med specialistkompetens i</h5>
                    <textarea class="form-control" name="specialist" rows='2' id="specialist"
                              ng-model="cert.bedomning.lakareSpecialKompetens" wc-maxlength ng-trim="false"
                              maxlength="71"></textarea>
                  </div>

                  <div class="body-row clearfix" id="vardenhetForm">
                    <h3 class="title">
                      <span message key="ts-diabetes.label.unit"></span>
                    </h3>

                    <div class="text">
                      <div class="alert alert-danger" ng-if="validationMessagesGrouped.vardenhet">
                        <ul>
                          <li ng-repeat="message in validationMessagesGrouped.vardenhet"><span message
                                                                                               key="{{message.message}}"></span>
                          </li>
                        </ul>
                      </div>
                      <label class="control-label">{{cert.intygMetadata.skapadAv.vardenhet.enhetsnamn}}
                        ({{cert.intygMetadata.skapadAv.vardenhet.enhetsid}}),
                        {{cert.intygMetadata.skapadAv.vardenhet.vardgivare.vardgivarnamn}}</label>

                      <div class="alert alert-info" ng-show="widgetState.hasInfoMissing">
                        Information om vårdenheten saknas i HSA-katalogen. Be den på vårdenheten som är ansvarig för
                        frågor om HSA att uppdatera informationen.
                      </div>

                      <div class="form-horizontal">
                        <div class="form-group">
                          <label class="col-xs-3 control-label">Postadress</label>
                          <div class="col-xs-9">
                            <input type="text" class="form-control input-full" id="clinicInfoPostalAddress"
                                   name="clinicInfo.postalAddress" ng-model="cert.intygMetadata.skapadAv.vardenhet.postadress"
                                   maxlength="70">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label">Postnummer</label>
                          <div class="col-xs-9">
                            <input type="text" class="form-control input-5" id="clinicInfoPostalCode"
                                   name="clinicInfo.postalCode" ng-model="cert.intygMetadata.skapadAv.vardenhet.postnummer"
                                   maxlength="6">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label">Postort</label>
                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfoPostalCity"
                                   name="clinicInfo.postalCity" ng-model="cert.intygMetadata.skapadAv.vardenhet.postort"
                                   maxlength="30">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label">Telefonnummer</label>
                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfoPhone" name="clinicInfo.phone"
                                   ng-model="cert.intygMetadata.skapadAv.vardenhet.telefonnummer" maxlength="20">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="body-row clearfix">
                    <div ng-if="specialiteter && specialiteter != ''">
                      <h4><span message key="ts-bas.label.specialkompetens"></span></h4>
                      <span> {{specialiteter}}</span><br />
                    </div>
                    <br />
                    <div ng-if="befattningar && befattningar.length > 0">
                      <h4><span message key="ts-bas.label.befattningar"></span></h4>
                      <span ng-repeat="befattning in befattningar"></span>
                    </div>
                    <br />
                  </div>

                  <div ng-if="!isSigned" class="print-hide">
                    <h3>Signera</h3>

                    <div id="sign-requires-doctor-message-text" ng-if="!user.userContext.lakare"
                         class="alert alert-info">
                      <span message key="draft.onlydoctorscansign"></span>
                    </div>

                    <button id="signera-utkast-button" class="btn btn-success"
                            ng-disabled="!isComplete || certForm.$dirty" ng-click="sign()"
                            ng-show="user.userContext.lakare">Signera intyget
                    </button>
                  </div>

                </div>
                <!-- cert body -->

              </div>
              <!-- certificate -->

            </div>
          </div>
        </form>
      </div>

    </div>
    <!-- span12 webcert-col-single -->
  </div>
  <!-- row -->
</div> <!-- container -->
