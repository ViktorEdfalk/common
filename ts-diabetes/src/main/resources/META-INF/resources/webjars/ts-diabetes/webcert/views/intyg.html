<div class="weak-hidden" ng-class="{show: widgetState.showTemplate}" ng-controller="ts-diabetes.ViewCertCtrl">
  <div wc-spinner label="info.loadingcertificate" show-spinner="!widgetState.doneLoading"
       show-content="widgetState.doneLoading">

    <div wc-print-header title-id="ts-diabetes.label.certtitle"
         print-message-id="print.label.{{widgetState.printStatus}}" intygs-id="cert.id"></div>

    <!-- error message -->
    <div id="cert-load-error" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey"
         class="alert alert-danger alert-column">
      <span message key="{{widgetState.activeErrorMessageKey}}"></span>
    </div>
    <div ng-show="!widgetState.activeErrorMessageKey" id="intyg-vy-laddad">

      <div class="print-hide">
        <div class="form-group buttonbar">
          <label class="control-label">{{cert.intygMetadata.patient.fullstandigtNamn}} - {{cert.intygMetadata.patient.personId}}</label>

          <form id="view-as-pdf" action="{{pdfUrl}}" method="get" target="_blank" name="pdfForm">
            <p class="btn-row">
              <button id="sendBtn" class="btn btn-info" ng-if="!certProperties.isSent && !certProperties.isRevoked"
                      wc-feature-active feature="skickaIntyg" intygstyp="ts-diabetes"
                      ng-click="send(cert)">Skicka till Transportstyrelsen
              </button>
              <button id="downloadprint" type="submit" value="submit" class="btn btn-info" ng-click="print(cert)">
                Skriv ut
              </button>
              <button id="copyBtn" class="btn btn-info" ng-if="!certProperties.isRevoked" ng-click="copy(cert)"
                      wc-feature-active feature="kopieraIntyg" intygstyp="ts-diabetes"
                      title="Kopiera intyg innebär att en kopia skapas av det befintliga intyget och med samma information.
I de fall patienten har ändrat namn eller adress så uppdateras den informationen.
Uppgifterna i intygsutkastet går att ändra innan det signeras.
Kopiera intyg kan användas exempelvis vid förlängning av en sjukskrivning.">
                Kopiera
              </button>
              <button id="makuleraBtn" class="btn btn-inverse" ng-if="!certProperties.isRevoked && user.lakare" ng-click="makulera(cert)"
                      wc-feature-active feature="makuleraIntyg" intygstyp="ts-diabetes"
                      title="Makulera intyg innebär att intyget återtas. Vid behov kan intyget ersättas med ett nytt.">
                Makulera
              </button>
            </p>
          </form>
        </div>

        <div class="alert alert-info alert-column" ng-if="!certProperties.isRevoked">
          <strong>Status:</strong>
          <span ng-if="certProperties.isSent" id="certificate-is-sent-to-recipient-message-text">Intyget är signerat och mottaget av Transportstyrelsens system.</span>
          <span ng-if="!certProperties.isSent" id="certificate-is-sent-to-it-message-text">
            Intyget är signerat och är nu tillgängligt för invånaren i webbtjänsten Mina intyg, som nås via 1177.se.
            Om patienten inte har möjlighet att skicka intyget elektroniskt till Transportstyrelsen kan du skicka intyget direkt till
            Transportstyrelsen åt patienten. Observera att patientens samtycke då krävs.
          </span>
        </div>
        <div ng-if="certProperties.isRevoked" id="certificate-is-revoked-message-text" class="alert alert-warning"
             style="margin-right: 20px; max-width: 530px;">Intyget är makulerat
        </div>
      </div>

      <div id="certificate" ng-class="{'certificate': true, 'revoked-certificate' : certProperties.isRevoked}">
        <div class="row">
          <div class="col-md-12">
            <div class="cert-body">

              <!-- Patientens uppgifter -->
              <div wc-field field-label="ts-bas.label.patientadress" filled="true">
                <span class="cert-answer"><span id="patientpostadress">{{cert.intygMetadata.patient.postadress}}</span><br><span id="patientpostnummer">{{cert.intygMetadata.patient.postnummer}}</span> <span id="patientpostort">{{cert.intygMetadata.patient.postort}}</span></span>
              </div>

              <!-- Intyget avser -->
              <div wc-field field-label="ts-diabetes.label.intygavser" filled="true">
                <span class="cert-answer" id="intygAvser">{{view.intygAvser}}</span>
              </div>

              <!-- Identiteten är styrkt genom -->
              <div wc-field field-label="ts-diabetes.label.identitet" filled="true">
                <span id="identitet"><span class="cert-answer" message key="ts-diabetes.label.identitet.{{cert.vardkontakt.idkontroll}}"></span></span>
              </div>

              <!-- 1. Allmänt diabetes -->
              <div wc-field field-label="ts-diabetes.label.allmant" filled="true">
                <p>
                  <span message key="ts-diabetes.label.diabetes.vilket-ar"></span><br>
                  <span id="observationsperiod"><span class="cert-answer">{{cert.diabetes.observationsperiod}}</span></span>
                </p>
                <p>
                  <span message key="ts-diabetes.label.diabetes.diabetestyp"></span><br>
                  <span id="diabetestyp"><span class="cert-answer" message
                        key="ts-diabetes.label.diabetes.diabetestyp.{{cert.diabetes.diabetestyp}}"></span></span>
                </p>

                <h3 message key="ts-diabetes.label.diabetes.behandling"></h3>
                <p>
                  <span message key="ts-diabetes.label.diabetes.behandling.endast-kost"></span>
                  <span id="endastKost"><span class="cert-answer" message key="{{cert.diabetes.endastKost | BoolToTextFilter}}"></span></span><br>

                  <span message key="ts-diabetes.label.diabetes.behandling.tabletter"></span>
                  <span id="tabletter"><span class="cert-answer" message key="{{cert.diabetes.tabletter | BoolToTextFilter}}"></span></span><br>

                  <span message key="ts-diabetes.label.diabetes.behandling.insulin"></span>
                  <span id="insulin"><span class="cert-answer" message key="{{cert.diabetes.insulin | BoolToTextFilter}}"></span></span><br>
                  <br>
                  <span ng-show="cert.diabetes.insulinBehandlingsperiod.length > 0">
                    <span message key="ts-diabetes.label.diabetes.behandling.insulin-period"></span><br>
                    <span class="cert-answer" id="insulinBehandlingsperiod">{{cert.diabetes.insulinBehandlingsperiod}}</span>
                  </span>
                </p>
                <p>
                  <span message key="ts-diabetes.label.diabetes.behandling.annan"></span><br>
                  <span id="annanBehandlingBeskrivning">
                    <span ng-show="cert.diabetes.annanBehandlingBeskrivning && cert.diabetes.annanBehandlingBeskrivning.length > 0">
                      <span class="cert-answer">{{cert.diabetes.annanBehandlingBeskrivning}}</span>
                    </span>
                    <span class="cert-answer" ng-show="!cert.diabetes.annanBehandlingBeskrivning">
                      <span message key="ts-diabetes.label.bedomning-info-ej-angivet"></span>
                    </span>
                  </span>
                </p>
              </div>

              <!-- 2. Hypoglykemier -->
              <div wc-field field-label="ts-diabetes.label.hypoglykemier" filled="true" class="print-pagebreak-after">

                <!-- a -->
                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.har-patient-kannedom"></span>
                  <span id="kunskapOmAtgarder"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.kunskapOmAtgarder | BoolToTextFilter}}"></span></span>
                </p>

                <!-- b -->
                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.tecken-nedsatt-hjarnfunktion"></span>
                  <span id="teckenNedsattHjarnfunktion"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.teckenNedsattHjarnfunktion | BoolToTextFilter}}"></span></span>
                </p>

                <!-- c -->
                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.saknar-formaga-kanna-varningstecken"></span>
                  <span id="saknarFormagaKannaVarningstecken"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.saknarFormagaKannaVarningstecken | BoolToTextFilter}}"></span></span>
                </p>

                <!-- d -->
                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst"></span>
                  <span id="allvarligForekomst"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.allvarligForekomst | BoolToTextFilter}}"></span></span>
                </div>
                <div class="form-group indent" ng-show="cert.hypoglykemier.allvarligForekomstBeskrivning">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst.beskrivning"></span>
                  <span id="allvarligForekomstBeskrivning"><span class="cert-answer">{{cert.hypoglykemier.allvarligForekomstBeskrivning}}</span></span><br>
                </div>

                <!-- e -->
                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken"></span>
                  <span id="allvarligForekomstTrafiken"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.allvarligForekomstTrafiken | BoolToTextFilter}}"></span></span>
                </div>
                <div class="form-group indent"
                     ng-show="cert.hypoglykemier.allvarligForekomstTrafikBeskrivning.length > 0">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken.beskrivning"></span>
                  <span id="allvarligForekomstTrafikBeskrivning"><span class="cert-answer">{{cert.hypoglykemier.allvarligForekomstTrafikBeskrivning}}</span></span>
                </div>

                <!-- f -->
                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.egenkontroll-blodsocker"></span>
                  <span id="egenkontrollBlodsocker"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.egenkontrollBlodsocker | BoolToTextFilter}}"></span></span>
                </div>

                <!-- g -->
                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-vaken-tid"></span>
                  <span id="allvarligForekomstVakenTid"><span class="cert-answer" message
                        key="{{cert.hypoglykemier.allvarligForekomstVakenTid | BoolToTextFilter}}"></span></span><br>
                  <p ng-show="cert.hypoglykemier.allvarligForekomstVakenTidObservationstid.length > 0">
                    <span message key="common.when"></span>
                    <span id="allvarligForekomstVakenTidObservationstid"><span class="cert-answer">{{cert.hypoglykemier.allvarligForekomstVakenTidObservationstid}}</span></span>
                  </p>
                </div>
              </div>

              <!-- 3 -->
              <div wc-field field-label="ts-diabetes.label.syn" filled="true">
                <p>
                  <span message key="ts-diabetes.label.syn.separat-ogonlakarintyg"></span>
                  <span id="separatOgonlakarintyg"><span class="cert-answer" message
                        key="{{cert.syn.separatOgonlakarintyg | BoolToTextFilter}}"></span></span>
                </p>

                <div ng-hide="cert.syn.separatOgonlakarintyg">
                  <p>
                    <span message key="ts-diabetes.label.syn.synfaltsprovning-utan-anmarkning"></span>
                    <span id="synfaltsprovningUtanAnmarkning"><span class="cert-answer" message
                          key="{{cert.syn.synfaltsprovningUtanAnmarkning | BoolToTextFilter}}"></span></span>
                  </p>
                  <p>
                    <span message key="ts-diabetes.label.syn.synskarpa"></span>
                  </p>
                  <div>
                    <table class="table table-condensed ts-table">
                      <tr>
                        <th></th>
                        <th>Utan korrektion</th>
                        <th>Med korrektion</th>
                      </tr>
                      <tr>
                        <td>Höger öga</td>
                        <td><span class="text" id="hogerutanKorrektion">{{cert.syn.hoger.utanKorrektion | number : 1}}</span></td>
                        <td><span class="text" id="hogermedKorrektion">{{cert.syn.hoger.medKorrektion | number : 1}}</span></td>
                      </tr>
                      <tr>
                        <td>Vänster öga</td>
                        <td><span class="text" id="vansterutanKorrektion">{{cert.syn.vanster.utanKorrektion | number : 1}}</span></td>
                        <td><span class="text" id="vanstermedKorrektion">{{cert.syn.vanster.medKorrektion | number : 1}}</span></td>
                      </tr>
                      <tr>
                        <td>Binokulärt</td>
                        <td><span class="text" id="binokulartutanKorrektion">{{cert.syn.binokulart.utanKorrektion | number : 1}}</span></td>
                        <td><span class="text" id="binokulartmedKorrektion">{{cert.syn.binokulart.medKorrektion | number : 1}}</span></td>
                      </tr>
                    </table>
                  </div>
                  <p>
                    <span message key="ts-diabetes.label.syn.diplopi"></span>
                    <span id="diplopi"><span class="cert-answer" message key="{{cert.syn.diplopi | BoolToTextFilter}}"></span></span>
                  </p>
                </div>
              </div>

              <!-- 4 bedomning -->
              <div wc-field field-label="ts-diabetes.label.bedomning" filled="true">

                <div ng-show="!cert.bedomning.kanInteTaStallning">
                  <span message key="ts-diabetes.label.bedomning-info-alt-1"></span>
                  <p>
                    <span id="bedomning"><span class="cert-answer">{{view.bedomning}}</span></span>
                  </p>
                </div>
                <div ng-show="cert.bedomning.kanInteTaStallning">
                  <span id="bedomningKanInteTaStallning"><span class="cert-answer" message
                        key="ts-diabetes.label.bedomning.kan-inte-ta-stallning"></span></span><br><br>
                </div>

                <div class="form-group">
                  <span message key="ts-diabetes.label.bedomning.lamplighet-inneha"></span><br>
                  <span id="lamplighetInnehaBehorighet"><span class="cert-answer" message
                        key="{{cert.bedomning.lamplighetInnehaBehorighet | BoolToTextFilter}}"></span></span>
                </div>

              </div>

              <div wc-field field-label="ts-diabetes.label.ovrigkommentar" filled="true">
                <div id="kommentar">
                  <span ng-show="cert.kommentar.length > 0">
                    <span class="cert-answer">{{cert.kommentar}}</span>
                  </span>
                  <span ng-show="!cert.kommentar">
                    <span class="cert-answer" message key="ts-diabetes.label.bedomning-info-ej-angivet"></span>
                  </span>
                </div>
              </div>

              <div wc-field field-label="ts-diabetes.label.bedomning-info-undersokas-med-specialkompetens"
                   filled="true">
                <div id="lakareSpecialKompetens">
                  <span ng-show="cert.bedomning.lakareSpecialKompetens.length > 0">
                    <span class="cert-answer">{{cert.bedomning.lakareSpecialKompetens}}</span><br>
                  </span>
                  <span class="cert-answer" ng-show="!cert.bedomning.lakareSpecialKompetens" message
                          key="ts-diabetes.label.bedomning-info-ej-angivet"></span>
                </div>
              </div>

              <div class="infobox">
                <h3>
                  <span message key="common.label.ovanstaende-har-bekraftats"></span>
                </h3>
                <h4>
                  <span message key="common.date"></span>
                </h4>
                <p id="signeringsdatum">{{cert.intygMetadata.signeringsdatum | date:'longDate'}}</p>
                <h4>
                  <span message key="ts-diabetes.label.kontakt-info"></span>
                </h4>
                <span id="vardperson_namn">{{cert.intygMetadata.skapadAv.fullstandigtNamn}}</span><br>
                <span id="vardperson_enhetsnamn">{{cert.intygMetadata.skapadAv.vardenhet.enhetsnamn}}</span><br>
                <span id="vardenhet_postadress">{{cert.intygMetadata.skapadAv.vardenhet.postadress}}</span><br>
                <span id="vardenhet_postnummer">{{cert.intygMetadata.skapadAv.vardenhet.postnummer}}</span> <span id="vardenhet_postort">{{cert.intygMetadata.skapadAv.vardenhet.postort}}</span><br>
                <span id="vardenhet_telefonnummer">{{cert.intygMetadata.skapadAv.vardenhet.telefonnummer}}</span><br>
              </div>

            </div>
            <!-- cert body -->
          </div>
        </div>
      </div>
    </div>
    <!-- entire cert -->
  </div>
  <!--  spinner end -->
</div>
