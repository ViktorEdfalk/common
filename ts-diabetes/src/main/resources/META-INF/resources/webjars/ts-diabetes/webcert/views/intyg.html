<div class="weak-hidden" ng-class="{show: widgetState.showTemplate}" ng-controller="ts-diabetes.ViewCertCtrl">
  <div wc-spinner label="info.loadingcertificate" show-spinner="!widgetState.doneLoading"
       show-content="widgetState.doneLoading">

    <!-- error message -->
    <div id="cert-load-error" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey"
         class="alert alert-danger alert-column">
      <span message key="{{widgetState.activeErrorMessageKey}}"></span>
    </div>
    <div ng-show="!widgetState.activeErrorMessageKey">
      <div class="form-group buttonbar">
        <label class="control-label">{{cert.patient.fullstandigtNamn}} - {{cert.patient.personid}}</label>

        <form id="view-as-pdf" action="{{pdfUrl}}" method="get" target="_blank" name="pdfForm">
          <p class="btn-row">
            <button class="btn btn-info">Skicka till Transportstyrelsen</button>
            <button id="downloadprint" type="submit" value="submit" class="btn btn-info"
                    onClick="document.pdfForm.submit()">Skriv ut
            </button>
            <button class="btn btn-info">Kopiera</button>
            <button class="btn btn-inverse">Rätta</button>
          </p>
        </form>
      </div>


      <div class="alert alert-info alert-column" ng-if="!certProperties.isRevoked">
        <strong>Status:</strong>
        <span ng-if="certProperties.isSent" id="certificate-is-sent-to-fk-message-text">Intyget är signerat och skickat till Transportstyrelsen.</span>
            <span ng-if="!certProperties.isSent" id="certificate-is-sent-to-it-message-text">
              Intyget är signerat och är nu tillgängligt för invånaren i webbtjänsten Mina intyg, som nås via 1177.se.
              Om patienten inte har möjlighet att skicka intyget elektroniskt till Transportstyrelsen kan du skicka intyget direkt till
              Transportstyrelsen åt patienten. Observera att patientens samtycke då krävs.
            </span>
      </div>
      <div ng-if="certProperties.isRevoked" id="certificate-is-revoked-message-text" class="alert alert-warning"
           style="margin-right: 20px; max-width: 530px;">Detta intyg är rättat
      </div>

      <div id="certificate" ng-class="{'certificate': true, 'revoked-certificate' : certProperties.isRevoked}">
        <div class="row">
          <div class="col-md-12">
            <div class="cert-body">

              <div wc-field field-label="ts-diabetes.label.intygavser" filled="true">
                <span class="ts-cert-answer">{{intygAvser}}</span>
              </div>

              <div wc-field field-label="ts-diabetes.label.identitet" filled="true">
                <span class="ts-cert-answer" message key="ts-diabetes.label.identitet.{{cert.vardkontakt.idkontroll}}"></span>
              </div>

              <div wc-field field-label="ts-diabetes.label.allmant" filled="true">
                <p>
                  <span message key="ts-diabetes.label.diabetes.diabetestyp"></span>
                  <span class="ts-cert-answer" message
                        key="ts-diabetes.label.diabetes.diabetestyp.{{cert.diabetes.diabetestyp}}"></span>
                </p>

                <h3 message key="ts-diabetes.label.diabetes.behandling"></h3>
                <p>
                  <span message key="ts-diabetes.label.diabetes.behandling.endast-kost"></span>
                  <span class="ts-cert-answer" message key="{{cert.diabetes.endastKost | BoolToTextFilter}}"></span>

                  <span message key="ts-diabetes.label.diabetes.behandling.tabletter"></span>
                  <span class="ts-cert-answer" message key="{{cert.diabetes.tabletter | BoolToTextFilter}}"></span>

                  <span message key="ts-diabetes.label.diabetes.behandling.insulin"></span>
                  <span class="ts-cert-answer" message key="{{cert.diabetes.insulin | BoolToTextFilter}}"></span>

                  <span ng-show="cert.diabetes.insulinBehandlingsperiod.length > 0">
                    <br>
                    <span message key="ts-diabetes.label.diabetes.behandling.insulin-period"></span>
                    <span class="ts-cert-answer">{{cert.diabetes.insulinBehandlingsperiod}}</span>
                  </span>
                </p>
                <p>
                  <span message key="ts-diabetes.label.diabetes.behandling.annan"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.diabetes.annanBehandling | BoolToTextFilter}}"></span>
                  <span ng-show="cert.diabetes.annanBehandling">
                    <br>
                    <span message key="ts-diabetes.label.diabetes.behandling.annan.period"></span>
                    <span class="ts-cert-answer">{{cert.diabetes.annanBehandlingBeskrivning}}</span>
                  </span>
                </p>

              </div>

              <div wc-field field-label="ts-diabetes.label.hypoglykemier" filled="true">
                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.har-patient-kannedom"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.hypoglykemier.kunskapOmAtgarder | BoolToTextFilter}}"></span>
                </p>

                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.tecken-nedsatt-hjarnfunktion"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.hypoglykemier.teckenNedsattHjarnfunktion | BoolToTextFilter}}"></span>
                </p>

                <p>
                  <span message key="ts-diabetes.label.hypoglykemier.saknar-formaga-kanna-varningstecken"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.hypoglykemier.saknarFormagaKannaVarningstecken | BoolToTextFilter}}"></span>
                </p>

                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.hypoglykemier.allvarligForekomst | BoolToTextFilter}}"></span>
                </div>
                <div class="form-group indent" ng-show="cert.hypoglykemier.allvarligForekomstBeskrivning">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst.beskrivning"></span>
                  <span class="ts-cert-answer">{{cert.hypoglykemier.allvarligForekomstBeskrivning}}</span><br>
                </div>

                <div class="form-group">
                  <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.hypoglykemier.allvarligForekomstTrafiken | BoolToTextFilter}}"></span>
                </div>
                <div class="form-group indent"
                     ng-show="cert.hypoglykemier.allvarligForekomstTrafikBeskrivning.length > 0">
                    <span message key="ts-diabetes.label.hypoglykemier.allvarlig-forekomst-trafiken.beskrivning"></span>
                  <span class="ts-cert-answer">{{cert.hypoglykemier.allvarligForekomstTrafikBeskrivning}}</span>
                </div>
              </div>

              <div wc-field field-label="ts-diabetes.label.syn" filled="true">
                <p>
                  <span message key="ts-diabetes.label.syn.separat-ogonlakarintyg"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.syn.separatOgonlakarintyg | BoolToTextFilter}}"></span>
                </p>
                <p>
                  <span message key="ts-diabetes.label.syn.synfaltsprovning-utan-anmarkning"></span>
                  <span class="ts-cert-answer" message
                        key="{{cert.syn.synfaltsprovningUtanAnmarkning | BoolToTextFilter}}"></span>
                </p>
                <p>
                  <span message key="ts-diabetes.label.syn.synskarpa"></span>
                </p>
                <div>
                  <table class="table table-condensed ts-table">
                    <tr>
                      <th></th>
                      <th>Utan korrektion</th>
                      <th>Med korrektion</th>
                    </tr>
                    <tr>
                      <td>Höger öga</td>
                      <td><span class="text">{{cert.syn.hoger.utanKorrektion | number : 1}}</span></td>
                      <td><span class="text">{{cert.syn.hoger.medKorrektion | number : 1}}</span></td>
                    </tr>
                    <tr>
                      <td>Vänster öga</td>
                      <td><span class="text">{{cert.syn.vanster.utanKorrektion | number : 1}}</span></td>
                      <td><span class="text">{{cert.syn.vanster.medKorrektion | number : 1}}</span></td>
                    </tr>
                    <tr>
                      <td>Binokulärt</td>
                      <td><span class="text">{{cert.syn.binokulart.utanKorrektion | number : 1}}</span></td>
                      <td><span class="text">{{cert.syn.binokulart.medKorrektion | number : 1}}</span></td>
                    </tr>
                  </table>
                </div>
                <p>
                  <span message key="ts-diabetes.label.syn.diplopi"></span>
                  <span class="ts-cert-answer" message key="{{cert.syn.diplopi | BoolToTextFilter}}"></span>
                </p>
              </div>

              <div wc-field field-label="ts-diabetes.label.bedomning" filled="true">
                <div ng-show="!cert.bedomning.kanInteTaStallning">
                  <span message key="ts-diabetes.label.bedomning-info-alt-1"></span>

                  <p>
                    <span class="ts-cert-answer">{{intygAvser}}</span>
                  </p>
                </div>

                <div ng-show="cert.bedomning.kanInteTaStallning">
                  {{ts-diabetes.label.bedomning-info-alt-2}}
                </div>

                <div>
                  <span message key="ts-diabetes.label.bedomning-info-undersokas-med-specialkompetens"></span><br>
                  <span class="ts-cert-answer" ng-show="cert.bedomning.lakareSpecialKompetens.length > 0">{{cert.bedomning.lakareSpecialKompetens}}</span><br>
                  <span class="ts-cert-answer" ng-show="!cert.bedomning.lakareSpecialKompetens" message
                        key="ts-diabetes.label.bedomning-info-ej-angivet"></span>
                </div>
              </div>

              <div class="infobox">
                <h3>
                  <span message key="ts-diabetes.label.ovanstaende-har-bekraftats"></span>
                </h3>
                <h4>
                  <span message key="common.date"></span>
                </h4>
                <p>{{cert.signeringsdatum | date:'longDate'}}</p>
                <h4>
                  <span message key="ts-diabetes.label.kontakt-info"></span>
                </h4>
                <span id="vardperson_namn">{{cert.skapadAv.fullstandigtNamn}}</span><br>
                <span id="vardperson_enhetsnamn">{{cert.skapadAv.vardenhet.enhetsnamn}}</span><br>
                {{cert.skapadAv.vardenhet.postadress}}<br>
                {{cert.skapadAv.vardenhet.postnummer}} {{cert.skapadAv.vardenhet.postort}}<br>
                {{cert.skapadAv.vardenhet.telefonnummer}}<br>
              </div>

            </div>
            <!-- cert body -->
          </div>
        </div>
      </div>
    </div>
    <!-- entire cert -->
  </div>
  <!--  spinner end -->
</div>
