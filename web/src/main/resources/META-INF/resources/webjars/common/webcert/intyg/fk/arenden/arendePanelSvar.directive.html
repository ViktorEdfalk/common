<div>
  <!-- error message occuring when interacting with server for komplettering-->
  <div id="internal-{{arendeSvar.fragaInternReferens}}-meddelande-load-error"
       ng-show="arendeSvar.activeKompletteringErrorMessageKey" class="alert alert-danger">
    <span message key="common.arende.error.{{arendeSvar.activeKompletteringErrorMessageKey}}"></span>
  </div>

  <div id="answerDisabledReasonPanel-{{arendeSvar.fragaInternReferens}}" class="alert alert-info"
       ng-show="arendeSvar.answerDisabled == true && arendeSvar.answerDisabledReason != ''">
    {{arendeSvar.answerDisabledReason}}
  </div>

  <!-- Svara med nytt intyg button - only on komplettering -->
  <div class="buttonbar" ng-show="showKompletteringControls()">

    <div id="komplettering-disabled-{{arendeSvar.fragaInternReferens}}" class="alert alert-warning" ng-if="arendeSvar.svaraMedNyttIntygDisabled == true">
      {{arendeSvar.svaraMedNyttIntygDisabledReason}}
    </div>
    <button type="button" class="btn" ng-if="showSvaraMedNyttIntygButton()" ng-class="{'btn-success': arendeSvar.status != 'CLOSED' && !arendeSvar.cannotKomplettera,
             'btn-default btn-secondary': arendeSvar.status == 'CLOSED' || arendeSvar.cannotKomplettera}"
            ng-click="answerWithIntyg()" ng-disabled="arendeSvar.cannotKomplettera" wc-check-vardenhet
            vardenhet="{{arendeSvar.enhetsid}}" id="answerWithIntygBtn-{{arendeSvar.fragaInternReferens}}">
      <img src="/img/loader-small-green.gif" ng-show="arendeSvar.updateInProgress"> Svara med nytt intyg
    </button>
        <span ng-show="arendeSvar.status != 'CLOSED'">
        <label for="{{panelId}}-cant-komplettera-{{arendeSvar.fragaInternReferens}}" class="checkbox-inline">
          <input id="{{panelId}}-cant-komplettera-{{arendeSvar.fragaInternReferens}}" type="checkbox"
                 ng-model="arendeSvar.cannotKomplettera" ng-change="onCannotKomplettera()" /> Kan ej svara med nytt
          intyg</label>
        </span>
  </div>

  <!-- Svarsdelen -->
  <div ng-if="showAnswerPanel()" class="fold-animation">
    <div class="panel-container">
      <div ng-if="showAnswer()" class="arende-block" ng-class="{'arende-block-handled': arendeSvar.status == 'CLOSED',
            'arende-block-fk' : (arendeSvar.frageStallare | lowercase) == 'wc',
             'arende-block-wc' : (arendeSvar.frageStallare | lowercase) == 'fk'}">

        <!-- UNHANDLEDTYPE: frågan är redan BESVARAD -->
        <!-- HANDLEDTYPE: frågan har en svarstext -->
        <div class="arende-block-head clearfix">
          <div class="pull-left" ng-switch="arendeSvar.frageStallare | lowercase">
            <!--  Frågaställaren var Vårdenheten - svaret måste kommit från FK -->
            Från: <span ng-switch-when="wc"><span class="arende-sender" message
                                                  key="arende.fragestallare.fk"></span></span>
            <!--  Frågaställaren var inte Vårdenheten - svaret måste alltså kommit från Vårdenheten -->
            <span ng-switch-default id="{{panelId}}-answer-svar-vard-aktor-namn-{{arendeSvar.internReferens}}"
                  class="arende-sender">{{arendeSvar.vardaktorNamn}}</span>
          </div>
          <div class="pull-right" ng-switch="arendeSvar.frageStallare | lowercase">
            <!-- motsatt villkor mot frågan -->
            <span ng-switch-when="wc">Mottaget: </span> <span ng-switch-default>Skickat: </span> <span
              class="arende-date">{{arendeSvar.svarSkickadDatum | date:'short'}}</span>
          </div>
        </div>
        <div id="{{panelId}}-{{arendeSvar.internReferens}}-meddelande" class="arende-block-body">
          {{arendeSvar.meddelande}}
        </div>
      </div>
    </div>

    <!-- KNAPPAR HANTERADE FRÅGOR -->
    <!-- None anymore -->

    <!-- KNAPPAR EJ HANTERADE FRÅGOR -->
    <!-- TA BORT arendeSvar.intygProperties.kompletteringOnly NÄR "SVAR SOM FÖLJER MED" ÄR IMPLEMENTERAT -->

    <div ng-if="showButtonBar()">

      <div class="form-group">

        <!-- Rubrik: Svar -->
        <label class="control-label" ng-show="showRegularAnswer()">Svar</label>

        <!-- ELLER varningsruta komplettering -->
        <div class="alert alert-warning" ng-show="showKompletteringWarning()">
          <strong>Viktigt!</strong> Konsekvensen av att skicka ett meddelande om att komplettering ej kan göras kan
          innebära att Försäkringskassans handläggare avslår ansökan om sjukpenning.<br>
          I det här meddelandet ska du inte skriva någon medicinsk information. Om du har behov av en dialog som
          innehåller medicinsk information ska du svara med nytt intyg.
        </div>

        <!-- ELLER inforuta komplettering EJ IMPLEMENTERAT än. Ingår i "SVAR SOM FÖLJER MED" komplettering funktionalitet.
        <div class="alert alert-info"
             ng-show="parentViewState.arendeSvar.intygProperties.kompletteringOnly">
          Här kan du föra en dialog med Försäkringskassan om ett intyg. Medicinsk information ska endast skickas via signerade intyg. När du signerat och skickar intyget till Försäkringskassan följer ditt meddelande som du skrivit med.
        </div> -->

        <div class="controls">
          <div class="form-group" ng-show="isAnswerAllowed()">
            <textarea wc-maxlength ng-trim="false" rows="13" maxlength="5000"
                      class="form-control col-md-9 arende-block-wc" ng-model="arendeSvar.meddelande"
                      id="answerText-{{arendeSvar.fragaInternReferens}}"></textarea>
          </div>
          <div class="webintyg-top-padding-section">
            <!-- error message occuring when interacting with server for this FragaSvar-->
            <div id="internal-{{arendeSvar.fragaInternReferens}}-svarsText-load-error"
                 ng-show="arendeSvar.activeErrorMessageKey" class="alert alert-danger">
              <span message key="fk7263.error.{{arendeSvar.activeErrorMessageKey}}"></span>
            </div>

            <button type="button" class="btn btn-success" ng-click="sendAnswer()"
                    ng-disabled="!arendeSvar.meddelande || arendeSvar.updateInProgress" ng-show="isAnswerAllowed()"
                    wc-check-vardenhet vardenhet="{{arendeSvar.enhetsId}}"
                    id="sendAnswerBtn-{{arendeSvar.fragaInternReferens}}">
              <img src="/img/loader-small-green.gif" ng-show="arendeSvar.updateInProgress"> Skicka svar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
