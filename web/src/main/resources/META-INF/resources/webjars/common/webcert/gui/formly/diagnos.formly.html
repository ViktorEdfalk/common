<div class="row bottom-padding-small">
    <div class='col-xs-12'>
        <div class="form-group">
            <div class="bottom-padding-small"><span class="bold valjkodverk" message key="common.sit.label.valj-version-icd-10"></span></div>
            <label class="radio-inline big-radio-label">
                <input type="radio" class="big-radio" id="diagnoseKodverk_ICD_10_SE" name="diagnosKodSystem" value="ICD_10_SE"
                       ng-model="formState.diagnosKodSystem" checked="checked"
                       ng-change="onChangeKodverk()">
                <span message key="common.sit.label.diagnoskodverk.fullstandig"></span>
            </label>
            <label class="radio-inline big-radio-label">
                <input type="radio" class="big-radio" id="diagnoseKodverk_KSH_97_P" name="diagnosKodSystem" value="KSH_97_P"
                       ng-model="formState.diagnosKodSystem" ng-change="onChangeKodverk()">
                <span message key="common.sit.label.diagnoskodverk.primarvard"></span>
            </label>
        </div>
    </div>
</div>

<div class="form-group">
    <table>
        <tr>
            <th>
                <span dynamic-label key="{{to.diagnosKodLabel}}.RBK"></span>
                <span ng-if="to.help" wc-help-mark field-dynamic-help-text="{{to.diagnosKodLabel}}.HLP"></span>
            </th>
            <th>
                <span dynamic-label key="{{to.diagnosBeskrivningLabel}}.RBK"></span>
                <span ng-if="to.help" wc-help-mark field-dynamic-help-text="{{to.diagnosBeskrivningLabel}}.HLP"></span>
            </th>
            <!--th>
            </th-->
        </tr>
        <tr class="diagnosRow" ng-repeat="diagnos in model[options.key]">
            <td>
                <div>
                    <input type="text" class="form-control" id="diagnoseCode-{{$index}}"
                           name="diagnoseCode{{$index}}"
                           value=""
                           placeholder="{{$index == 0 ? 'Huvuddiagnos' : 'Bidiagnos'}}"
                           class='diagnose-code col-xs-11 form-control'
                           ng-model="diagnos.diagnosKod"
                           ng-change="onDiagnoseCodeChanged($index)"
                           uib-typeahead="d.value as d.label for d in getDiagnoseCodes(formState.diagnosKodSystem, $viewValue) | limitTo:10"
                           typeahead-min-length="3"
                           typeahead-editable="false"
                           typeahead-on-select="onDiagnoseCodeSelect($index, $item)"
                           typeahead-template-url="/web/webjars/common/webcert/gui/formly/diagnos.formly.typeahead_template.html"
                           typeahead-loading="diagnosKodLoading[$index]"
                           typeahead-no-results="diagnosKodNoResults[$index]"
                           ng-blur="onBlurDiagnoseCodeField($index)">
                    <img src="/img/ajax-loader-kit-16x16.gif" class="diagnos-loading" ng-if="diagnosKodLoading[$index]" />
                </div>
                <span ng-if="diagnosKodNoResults[$index] && form['diagnoseCode'+$index].$viewValue.length > 2" uib-dropdown uib-dropdown-toggle
                    auto-close="disabled" is-open="true">
                      <ul uib-dropdown-menu>
                            <li><a href>Inga matchande diagnoser funna</a></li>
                      </ul>
                </span>
                <span ng-if="form['diagnoseCode'+$index].$viewValue.length > 0 && form['diagnoseCode'+$index].$viewValue.length < 3" uib-dropdown
                    uib-dropdown-toggle auto-close="disabled" is-open="true">
                      <ul uib-dropdown-menu>
                            <li><a href>Ange 3 tecken för att söka diagnoskod</a></li>
                      </ul>
                </span>
            </td>
            <td class="diagnosDescriptionColumn">
                <input type="text" class="col-xs-12 form-control maxwidth" id="diagnoseDescription-{{$index}}"
                       name="diagnose.description"
                       value=""
                       ng-model= "diagnos.diagnosBeskrivning"
                       ng-change="onDiagnoseDescriptionChanged($index)"
                       uib-typeahead="d.value as d.label for d in searchDiagnoseByDescription(formState.diagnosKodSystem, $viewValue)"
                       typeahead-on-select="onDiagnoseDescriptionSelect($index, $item)"
                       typeahead-template-url="/web/webjars/common/webcert/gui/formly/diagnos.formly.typeahead_template.html"
                       typeahead-wait-ms="100">
            </td>
        </tr>
    </table>
</div>
