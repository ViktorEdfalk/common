<div>
  <!-- error message -->
  <div id="intyg-load-error" ng-show="viewState.common.doneLoading && viewState.common.activeErrorMessageKey"
       class="alert alert-danger alert-column">

    <span ng-if="!(intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined)">
      <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
    </span>

    <div
        ng-if="intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined">
      <p>
        <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
      </p>
      <p><strong>Intygsinformation</strong></p>
      <ul>
        <li>Patient: {{intygBackup.intyg.patientNamn}} ({{intygBackup.intyg.patientId.patientIdExtension}})</li>
        <li>Signerat: {{intygBackup.intyg.signeringsDatum | date:'short'}}</li>
        <li>ID: {{intygBackup.intyg.intygsId}}</li>
      </ul>
    </div>
  </div>

  <div wc-intyg-related-other-intyg-message
       view-state="viewState"
       text-before-relation="ersatts av"
       intyg-relation="replacedByIntyg">
  </div>

  <div wc-intyg-related-other-intyg-message
       view-state="viewState"
       text-before-relation="kompletterats av"
       intyg-relation="complementedByIntyg">
  </div>

  <div ng-show="!viewState.common.activeErrorMessageKey" id="intyg-vy-laddad">
    <div>
      <div class="form-group">
        <div class="inline-block" style="margin-right:10px"
             wc-intyg-patient-namn-personnummer
             patient-name="viewState.intygModel.grundData.patient.fullstandigtNamn"
             patient-deceased="isPatientDeceased()"
             person-id="viewState.intygModel.grundData.patient.personId">
        </div>
      </div>
      <div class="form-group">
        <div class="btn-row">
          <button type="button"
                  id="sendBtn"
                  class="btn btn-info"
                  wc-authority feature="skickaIntyg"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  wc-check-vardenhet vardenhet="{{viewState.enhetsId}}"
                  ng-if="showSkickaButton()"
                  ng-click="send()">
            <span message key="{{intygstyp}}.button.send"></span>
          </button>
          <!-- Normal pdf-utskrift av signerat intyg  -->
          <button type="button"
                  id="downloadprint"
                  class="btn btn-info"
                  intygstyp="{{intygstyp}}"
                  ng-if="showPrintBtn()"
                  ng-click="print(viewState.intygModel, false)">
            <span message key="common.button.save.as.pdf"></span>
          </button>
          <div id="downloadprintemployer" intygstyp="{{intygstyp}}" style="display:inline;">
            <div class="btn-group" ng-if="showEmployerPrintBtn()">
              <button type="button"
                      id="intyg-header-dropdown-select-pdf-type"
                      class="btn btn-info dropdown-toggle"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false">
                <span message key="common.button.save.as.pdf"></span> <span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <!--<li wc-authority feature="utskrift">-->
                <li ng-if="utskrift">
                  <a href="#" onClick="return false;" ng-click="print(viewState.intygModel, false)">
                    <span message key="common.button.save.as.pdf.full"></span>
                  </a>
                </li>
                <!--<li wc-authority feature="arbetsgivarUtskrift"-->
                <li ng-if="arbetsgivarUtskrift"
                    uib-popover="{{employerPrintBtnTooltipText}}"
                    popover-trigger="mouseenter"
                    popover-popup-delay="300"
                    popover-append-to-body="true"
                    popover-placement="auto top">
                  <a href="#" onClick="return false;" ng-click="print(viewState.intygModel, true)">
                    <span message key="common.button.save.as.pdf.mininmal"></span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="copyBtn"
                  class="btn btn-info"
                  ng-if="showKopieraButton()"
                  ng-click="copy(viewState.intygModel)"
                  uib-popover="{{copyBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true"
                  popover-placement="auto top">
            Kopiera
          </button>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="fornyaBtn"
                  class="btn btn-info"
                  ng-if="showFornyaButton()"
                  ng-click="fornya(viewState.intygModel)"
                  uib-popover="{{fornyaBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true"
                  popover-placement="auto top">
            Förnya
          </button>
          <button type="button"
                  wc-authority="ERSATTA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="ersattBtn"
                  class="btn btn-info"
                  ng-if="showErsattButton()"
                  ng-click="ersatt(viewState.intygModel)"
                  wc-check-vardenhet
                  vardenhet="{{viewState.enhetsId}}"
                  uib-popover="{{ersattBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true"
                  popover-placement="auto top">
            Ersätt
          </button>

          <button type="button"
                  wc-authority="MAKULERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="makuleraBtn"
                  class="btn btn-default pull-right"
                  ng-if="!makuleratIntyg()"
                  ng-click="makulera(viewState.intygModel)"
                  wc-check-vardenhet
                  vardenhet="{{viewState.enhetsId}}"
                  uib-popover="Om intyget innehåller ett allvarligt fel, exempelvis utfärdat på fel patient, kan du makulera intyget. Ett fönster öppnas där du kan gå vidare och makulera intyget."
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true"
                  popover-placement="auto top"
                  popover-class="z-low">
            Makulera
          </button>
        </div>
        <div class="clearfix"></div>
      </div>

      <div wc-secrecy-mark-message person-id="viewState.intygModel.grundData.patient.personId" type="intyg"></div>

      <div id="intyg-inline-error" ng-show="viewState.common.inlineErrorMessageKey" class="alert alert-danger alert-column">
        <span message key="{{viewState.common.inlineErrorMessageKey}}"></span>
      </div>

      <div wc-new-person-id-message></div>

      <div class="alert alert-info alert-column" ng-if="!viewState.common.intygProperties.isRevoked && !viewState.common.isIntygOnRevokeQueue">
        <strong>Status:</strong>
        <span ng-if="viewState.common.intygProperties.isSent" id="certificate-is-sent-to-recipient-message-text" message key="{{intygstyp}}.label.status.recieved"></span>
        <span ng-if="!viewState.common.intygProperties.isSent && !viewState.common.isIntygOnSendQueue" id="certificate-is-sent-to-it-message-text" message key="{{intygstyp}}.label.status.signed"></span>
        <span ng-if="!viewState.common.intygProperties.isSent && viewState.common.isIntygOnSendQueue" id="certificate-is-on-sendqueue-to-it-message-text" message key="{{intygstyp}}.label.status.sent"></span>
      </div>

      <div wc-patient-info-change-message></div>

      <div ng-if="viewState.common.intygProperties.isRevoked || viewState.common.isIntygOnRevokeQueue" id="certificate-is-revoked-message-text" class="alert alert-warning"
           style="margin-right: 20px; max-width: 530px;">
        <span ng-if="viewState.common.isIntygOnRevokeQueue" id="certificate-revoked-it-message-text" message key="intyg.status.revoke.requested"></span>
        <span ng-if="viewState.common.intygProperties.isRevoked && (!viewState.common.isIntygOnRevokeQueue || viewState.common.isIntygOnRevokeQueue == 'undefined')" id="certificate-revoked-on-queue-it-message-text" message key="intyg.status.revoke.confirmed"></span>
      </div>

    </div>
  </div>
</div>
