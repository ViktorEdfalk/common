<div>
  <div wc-print-header title-id="{{intygstyp}}.label.certtitle" print-message-id="print.label.{{viewState.common.intygProperties.printStatus}}"
       intygs-id="viewState.common.intygModel.id"></div>

  <!-- error message -->
  <div id="intyg-load-error" ng-show="viewState.common.doneLoading && viewState.common.activeErrorMessageKey"
       class="alert alert-danger alert-column print-hide">

    <span ng-if="!(intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined)">
      <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
    </span>

    <div
        ng-if="intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined">
      <p>
        <span message key="{{viewState.common.activeErrorMessageKey}}"></span>
      </p>
      <p><strong>Intygsinformation</strong></p>
      <ul>
        <li>Patient: {{intygBackup.intyg.patientNamn}} ({{intygBackup.intyg.patientId.patientIdExtension}})</li>
        <li>Signerat: {{intygBackup.intyg.signeringsDatum | date:'short'}}</li>
        <li>ID: {{intygBackup.intyg.intygsId}}</li>
      </ul>
    </div>
  </div>

  <div ng-show="!viewState.common.activeErrorMessageKey" id="intyg-vy-laddad">
    <div class="print-hide">
      <div class="form-group">
        <div wc-intyg-relations></div>
      </div>
      <div class="form-group buttonbar">
        <div class="btn-row">
          <button type="button"
                  id="sendBtn"
                  class="btn btn-info"
                  wc-authority feature="skickaIntyg"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  wc-check-vardenhet vardenhet="{{viewState.enhetsId}}"
                  ng-if="visaSkickaKnappen()"
                  ng-click="send()">
            <span message key="{{intygstyp}}.button.send"></span>
          </button>
          <!-- Normal pdf-utskrift av signerat intyg  -->
          <button type="button"
                  id="downloadprint"
                  class="btn btn-info"
                  intygstyp="{{intygstyp}}"
                  ng-if="showPrintBtn() && !makuleratIntyg()"
                  ng-click="print(viewState.intygModel, false)">
            <span message key="common.button.save.as.pdf"></span>
          </button>
          <!-- html utskrift av makulerat intyg  -->
          <button type="submit"
                  value="submit"
                  class="btn btn-info"
                  ng-if="makuleratIntyg()"
                  ng-click="print(viewState.intygModel, false)">
            Skriv ut
          </button>
          <div id="downloadprintemployer" intygstyp="{{intygstyp}}" style="display:inline;">
            <div class="btn-group" ng-if="showEmployerPrintBtn() && !makuleratIntyg()">
              <button type="button"
                      id="intyg-header-dropdown-select-pdf-type"
                      class="btn btn-info dropdown-toggle"
                      data-toggle="dropdown"
                      aria-haspopup="true"
                      aria-expanded="false">
                <span message key="common.button.save.as.pdf"></span><span class="caret"></span>
              </button>
              <ul class="dropdown-menu">
                <!--<li wc-authority feature="utskrift">-->
                <li ng-if="utskrift">
                  <a href="#" onClick="return false;" ng-click="print(viewState.intygModel, false)">
                    <span message key="common.button.save.as.pdf.full"></span>
                  </a>
                </li>
                <!--<li wc-authority feature="arbetsgivarUtskrift"-->
                <li ng-if="arbetsgivarUtskrift"
                    uib-popover="{{employerPrintBtnTooltipText}}"
                    popover-trigger="mouseenter"
                    popover-popup-delay="300"
                    popover-append-to-body="true"
                    popover-placement="auto top">
                  <a href="#" onClick="return false;" ng-click="print(viewState.intygModel, true)">
                    <span message key="common.button.save.as.pdf.mininmal"></span>
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="copyBtn"
                  class="btn btn-info"
                  ng-if="!viewState.common.intygProperties.isRevoked && !viewState.common.isIntygOnRevokeQueue && !viewState.common.common.sekretessmarkering"
                  ng-click="copy(viewState.intygModel)"
                  uib-popover="{{copyBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Kopiera
          </button>
          <button type="button"
                  wc-authority="KOPIERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="fornyaBtn"
                  class="btn btn-info"
                  ng-if="intygstyp === 'fk7263' && !viewState.common.intygProperties.isRevoked && !viewState.common.isIntygOnRevokeQueue && !viewState.common.common.sekretessmarkering"
                  ng-click="fornya(viewState.intygModel)"
                  uib-popover="{{fornyaBtnTooltipText}}"
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Förnya
          </button>
          <button type="button"
                  wc-authority="MAKULERA_INTYG"
                  request-origin="!UTHOPP"
                  intygstyp="{{intygstyp}}"
                  id="makuleraBtn"
                  class="btn btn-inverse"
                  ng-if="!viewState.common.intygProperties.isRevoked && !viewState.common.isIntygOnRevokeQueue"
                  ng-click="makulera(viewState.intygModel)"
                  wc-check-vardenhet
                  vardenhet="{{viewState.enhetsId}}"
                  uib-popover="Makulerar intyget. Vid behov kan intyget ersättas med ett nytt."
                  popover-trigger="mouseenter"
                  popover-popup-delay="300"
                  popover-append-to-body="true">
            Makulera
          </button>
        </div>
      </div>

      <div wc-secrecy-mark-message person-id="viewState.intygModel.grundData.patient.personId" type="intyg"></div>

      <div id="intyg-inline-error" ng-show="viewState.common.inlineErrorMessageKey" class="alert alert-danger alert-column print-hide">
        <span message key="{{viewState.common.inlineErrorMessageKey}}"></span>
      </div>

      <div wc-new-person-id-message></div>

      <div class="alert alert-info alert-column" ng-if="!viewState.common.intygProperties.isRevoked && !viewState.common.isIntygOnRevokeQueue">
        <strong>Status:</strong>
        <span ng-if="viewState.common.intygProperties.isSent" id="certificate-is-sent-to-recipient-message-text" message key="{{intygstyp}}.label.status.recieved"></span>
        <span ng-if="!viewState.common.intygProperties.isSent && !viewState.common.isIntygOnSendQueue" id="certificate-is-sent-to-it-message-text" message key="{{intygstyp}}.label.status.signed"></span>
        <span ng-if="!viewState.common.intygProperties.isSent && viewState.common.isIntygOnSendQueue" id="certificate-is-on-sendqueue-to-it-message-text" message key="{{intygstyp}}.label.status.sent"></span>

      </div>

      <div ng-if="patient.changedName || patient.changedAddress" class="alert alert-info alert-column">
        <span id="intyg-djupintegration-name-changed" ng-if="patient.changedName && !patient.changedAddress" message key="intyg.status.patient.name.changed"></span>
        <span id="intyg-djupintegration-address-changed" ng-if="!patient.changedName && patient.changedAddress" message key="intyg.status.patient.address.changed"></span>
        <span id="intyg-djupintegration-name-and-address-changed" ng-if="patient.changedName && patient.changedAddress" message key="intyg.status.patient.name.and.address.changed"></span>
      </div>

      <div ng-if="viewState.common.intygProperties.isRevoked || viewState.common.isIntygOnRevokeQueue" id="certificate-is-revoked-message-text" class="alert alert-warning"
           style="margin-right: 20px; max-width: 530px;">
        <span ng-if="viewState.common.isIntygOnRevokeQueue" id="certificate-revoked-it-message-text" message key="intyg.status.revoke.requested"></span>
        <span ng-if="viewState.common.intygProperties.isRevoked && (!viewState.common.isIntygOnRevokeQueue || viewState.common.isIntygOnRevokeQueue == 'undefined')" id="certificate-revoked-on-queue-it-message-text" message key="intyg.status.revoke.confirmed"></span>
      </div>


    </div>
  </div>
</div>
