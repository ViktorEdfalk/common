<div wc-print-header title-id="{{viewState.common.intyg.type}}.label.certtitle" print-message-id="print.label.draft" intygs-id="cert.id"></div>
<div class="print-show">
  <label class="control-label">{{viewState.intygModel.grundData.patient.fullstandigtNamn}} - {{viewState.intygModel.grundData.patient.personId}}</label>
</div>

<div class="header-fix-top print-hide" wc-size-source="viewState.common.headerSize">
  <div class="header-wrapper menucollapse" ng-hide="viewState.common.collapsedHeader" wc-detect-animation>
    <div ui-view="wcHeader"></div>
  </div>

  <div ng-hide="viewState.common.error.activeErrorMessageKey">
    <div wc-spinner label="info.loadingdata" show-spinner="!viewState.common.doneLoading"
         show-content="viewState.common.doneLoading" is-header="true">

      <div class="header-fix-panel">
        <div class="header-fix-top-expand">
          <div class="header-fix-top-expand-wrapper">
            <button class="btn btn-link" ng-click="toggleHeader()"><span
                ng-if="viewState.common.collapsedHeader">Visa</span><span
                ng-if="!viewState.common.collapsedHeader">Dölj</span> meny
            </button>
          </div>
        </div>
        <a id="tillbakaButton" wc-feature-not-active feature="franJournalsystem" class="backlink-icon"
           href wc-back title="Tillbaka till Skriv intyg"></a>
        <h1 style="display: inline-block; margin-right: 20px;">
          <span message key="{{viewState.common.intyg.type}}.label.certtitle"></span>
        </h1>

        <div class="inline-block">
          <label class="control-label" id="patientNamnPersonnummer">{{viewState.intygModel.grundData.patient.fullstandigtNamn}} -
            {{viewState.intygModel.grundData.patient.personId}}</label>
        </div>

        <div wc-new-person-id-message></div>

        <div class="form-group buttonbar">
          <button class="btn btn-default btn-secondary" wc-feature-not-active feature="franJournalsystem" ng-disabled="viewState.common.intyg.isComplete"
                  ng-click="updatePatientData()" id="fetchPatientButton"
                  title="Hämta personuppgifter från folkbokföringsregistret.">
            <img ng-show="viewState.common.fetchingPatientData" ng-src="/img/loader-small.gif"/> Hämta personuppgifter
          </button>
          <button class="btn btn-default btn-secondary" ng-if="!viewState.common.showComplete" ng-disabled="viewState.common.intyg.isComplete"
                  ng-click="toggleShowComplete()" id="showCompleteButton"
                  title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">
            Visa vad som saknas
          </button>
          <button class="btn btn-default btn-secondary" ng-if="viewState.common.showComplete" ng-disabled="viewState.common.intyg.isComplete"
                  ng-click="toggleShowComplete()"  id="hideCompleteButton"
                  title="Visar vilka obligatoriska fält i utkastet som inte är ifyllda. Alla obligatoriska fält måste vara ifyllda för att utkastet ska kunna signeras.">
            Dölj vad som saknas
          </button>
          <button id="skriv-ut-utkast" class="btn btn-default btn-secondary" ng-if="!viewState.common.isSigned" ng-click="print()"
                  title="Skriver ut utkastet.">
            <span message key="{{viewState.common.intyg.type}}.label.skriv-ut-utkast"></span>
          </button>
          <button id="ta-bort-utkast" class="btn btn-default btn-secondary" ng-if="!viewState.common.isSigned" ng-click="discard()"
                  title="Klicka på papperskorgen för att radera utkastet.">
            <i class="glyphicon glyphicon-trash"></i>
          </button>
          <div wc-spinner label="common.label.saving" show-spinner="viewState.common.saving" class="wc-spinner-inline"></div>
          <div>{{view}}</div>
        </div>

        <div wc-secrecy-mark-message person-id="viewState.intygModel.grundData.patient.personId" type="utkast"></div>

        <!-- Show save errors here to spare user from retyping everything for intermittent errors -->
        <div class="row">
          <div ng-show="viewState.common.error.saveErrorCode != null" class="col-md-7">
            <div class="alert alert-danger">
              <span ng-bind-html="viewState.common.error.saveErrorMessage"></span>
            </div>
          </div>
        </div>

        <!-- Just in case -->
        <div id="certificate-is-sent-to-it-message-text" ng-show="viewState.common.isSigned">
          <span message key="draft.status.signed"></span>
        </div>
        <!-- complete -->
        <div ng-show="!viewState.common.saving && certForm.$pristine && viewState.common.intyg.isComplete && !viewState.common.isSigned">
          <span id="intyget-sparat-och-komplett-meddelande" message key="draft.status.draft_complete"></span>
        </div>
        <!-- incomplete -->
        <div ng-show="!viewState.common.saving && certForm.$pristine && !viewState.common.intyg.isComplete">
          <span id="intyget-sparat-och-ej-komplett-meddelande" message key="draft.status.draft_incomplete"></span>
        </div>
        <!-- form changed -->
        <div ng-show="viewState.common.saving || certForm.$dirty"><span message key="draft.status.changed"></span></div>
      </div>
    </div>
  </div>
</div>

<!-- Total fail error messages -->
<div id="error-panel" class="cert-error-panel"
     ng-show="viewState.common.doneLoading && viewState.common.error.activeErrorMessageKey && !viewState.common.deleted">
  <div class="alert alert-danger">
    <span message key="{{viewState.common.error.activeErrorMessageKey}}"></span>
  </div>
</div>

<ul>
  <li ng-repeat="message in validationMessages">
    <span message key="{{message.message}}"></span></li>
</ul>
<!-- intygeditheader end -->