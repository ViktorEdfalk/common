<div>
  <div id="answerDisabledReasonPanel-{{arendeSvar.fragaInternReferens}}" class="alert alert-info"
       ng-show="arendeSvar.answerDisabled == true && arendeSvar.answerDisabledReason">
    {{arendeSvar.answerDisabledReason}}
  </div>

  <!-- Svara med nytt intyg button - only on komplettering -->
  <div class="buttonbar" ng-if="showKompletteringControls()">
    <div arende-panel-svar-kompletteringsatgard parent-view-state="parentViewState" arende-list-item="arendeListItem"  on-answer-with-message="answerWithMessage()"></div>

  </div>

  <!-- Svarsdelen -->
  <div ng-if="showAnswerPanel()" class="fold-animation">
    <div class="panel-container">
      <div ng-if="showAnswer()" class="arende-block" ng-class="{'arende-block-handled': arendeSvar.status == 'CLOSED',
            'arende-block-fk' : (arendeSvar.frageStallare | lowercase) == 'wc',
             'arende-block-wc' : (arendeSvar.frageStallare | lowercase) == 'fk'}">

        <!-- UNHANDLEDTYPE: frågan är redan BESVARAD -->
        <!-- HANDLEDTYPE: frågan har en svarstext -->
        <div class="arende-block-head clearfix">
          <div class="pull-left" ng-switch="arendeSvar.frageStallare | lowercase">
            <!--  Frågaställaren var Vårdenheten - svaret måste kommit från FK -->
            Från: <span ng-switch-when="wc"><span class="arende-sender" message
                                                  key="common.arende.fragestallare.fk"></span></span>
            <!--  Frågaställaren var inte Vårdenheten - svaret måste alltså kommit från Vårdenheten -->
            <span ng-switch-default id="{{panelId}}-answer-svar-vard-aktor-namn-{{arendeSvar.internReferens}}"
                  class="arende-sender">{{arendeSvar.vardaktorNamn}}</span>
          </div>
          <div class="pull-right" ng-switch="arendeSvar.frageStallare | lowercase">
            <!-- motsatt villkor mot frågan -->
            <span ng-switch-when="wc">Mottaget: </span> <span ng-switch-default>Skickat: </span> <span
              class="arende-date">{{arendeSvar.svarSkickadDatum | date:'short'}}</span>
          </div>
        </div>
        <div id="{{panelId}}-{{arendeSvar.internReferens}}-meddelande" class="arende-block-body">
          {{arendeSvar.meddelande}}
          <div ng-if="arendeSvar.answeredWithIntyg">
            <span message key="common.arende.svar.besvaradmedintyg"></span><br>
            <button class="btn btn-link btn-link__purelink" ng-click='goToIntyg()' ><span message key="common.arende.svar.go"></span></button>
          </div>
        </div>
      </div>
    </div>

    <!-- KNAPPAR HANTERADE FRÅGOR -->
    <div ng-if="!showButtonBar()">
      <div id="internal-{{arendeSvar.fragaInternReferens}}-closedArende-error"
           ng-show="arendeListItem.activeErrorMessageKey" class="alert alert-danger">
        <span message key="common.error.{{arendeListItem.activeErrorMessageKey}}"></span>
      </div>
    </div>

    <!-- KNAPPAR EJ HANTERADE FRÅGOR -->
    <!-- TA BORT arendeSvar.intygProperties.kompletteringOnly NÄR "SVAR SOM FÖLJER MED" ÄR IMPLEMENTERAT -->

    <div ng-if="showButtonBar()">

      <div class="form-group">

        <!-- Rubrik: Svar -->
        <label class="control-label" ng-show="isAnswerAllowed()">Svar</label>


        <!-- ELLER inforuta komplettering EJ IMPLEMENTERAT än. Ingår i "SVAR SOM FÖLJER MED" komplettering funktionalitet.
        <div class="alert alert-info"
             ng-show="parentViewState.arendeSvar.intygProperties.kompletteringOnly">
          Här kan du föra en dialog med Försäkringskassan om ett intyg. Medicinsk information ska endast skickas via signerade intyg. När du signerat och skickar intyget till Försäkringskassan följer ditt meddelande som du skrivit med.
        </div> -->

        <div class="controls">
          <div class="form-group" ng-show="isAnswerAllowed()">
            <textarea wc-maxlength ng-trim="false" rows="13" maxlength="5000"
                      class="form-control col-md-9 arende-block-wc" ng-model="arendeSvar.meddelande"
                      id="answerText-{{arendeSvar.fragaInternReferens}}"></textarea>
          </div>
          <div class="webintyg-top-padding-section">
            <!-- error message occuring when interacting with server for this FragaSvar-->
            <div id="internal-{{arendeSvar.fragaInternReferens}}-svarsText-load-error"
                 ng-show="arendeSvar.activeErrorMessageKey" class="alert alert-danger">
              <span message key="common.error.{{arendeSvar.activeErrorMessageKey}}"></span>
            </div>

            <button type="button" class="btn btn-success" ng-click="sendAnswer()"
                    ng-disabled="!arendeSvar.meddelande || arendeSvar.updateInProgress" ng-show="isAnswerAllowed()"
                    wc-check-vardenhet vardenhet="{{arendeSvar.enhetsId}}"
                    id="sendAnswerBtn-{{arendeSvar.fragaInternReferens}}">
              <img src="/img/loader-small-green.gif" ng-show="arendeSvar.updateInProgress"> Skicka svar
            </button>
            <button type="button" class="btn btn-default btn-info" ng-click="abortTextAnswer()"
                    ng-show="arendeSvar.answerKompletteringWithText"
                    id="abortAnswerBtn-{{qa.internReferens}}"> Avbryt
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
