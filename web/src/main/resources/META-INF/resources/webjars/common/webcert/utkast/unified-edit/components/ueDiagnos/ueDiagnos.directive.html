<div class="row bottom-padding-small">
    <div class='col-xs-12'>
        <div class="form-group">
            <div class="bottom-padding-small"><span class="bold valjkodverk" dynamic-label key="common.sit.label.valj-version-icd-10"></span></div>
            <label class="radio-inline big-radio-label">
                <input type="radio" class="big-radio" id="diagnoseKodverk_ICD_10_SE" name="diagnosKodSystem" value="ICD_10_SE"
                       ng-model="diagnosViewState.diagnosKodSystem" checked="checked"
                       ng-change="onChangeKodverk(); validate()">
                <span dynamic-label key="common.sit.label.diagnoskodverk.fullstandig"></span>
            </label>
            <label class="radio-inline big-radio-label">
                <input type="radio" class="big-radio" id="diagnoseKodverk_KSH_97_P" name="diagnosKodSystem" value="KSH_97_P"
                       ng-model="diagnosViewState.diagnosKodSystem" ng-change="onChangeKodverk(); validate()">
                <span dynamic-label key="common.sit.label.diagnoskodverk.primarvard"></span>
            </label>
        </div>
    </div>
</div>

<ng-form name="diagnosForm" class="ueDiagnos">
    <table>
        <tr>
            <th>
                <span dynamic-label key="{{::config.diagnosKodLabel}}"></span>
                <span ng-if="::config.enableHelp">
                  <span wc-help-chevron help-text-key="{{::config.diagnosKodHelp}}"></span>
                  <span wc-help-chevron-text help-text-key="{{::config.diagnosKodHelp}}"></span>
                </span>
            </th>
            <th>
                <span dynamic-label key="{{::config.diagnosBeskrivningLabel}}"></span>
                <span ng-if="::config.enableHelp">
                  <span wc-help-chevron help-text-key="{{::config.diagnosBeskrivningHelp}}"></span>
                  <span wc-help-chevron-text help-text-key="{{::config.diagnosBeskrivningHelp}}"></span>
                </span>
            </th>
        </tr>
        <tr class="diagnosRow" ng-repeat="diagnos in model[config.modelProp]">
            <td>
                <div>
                    <input type="text" class="form-control" ng-attr-id="diagnoseCode-{{::$index|ueDomIdFilter}}"
                           name="diagnoseCode{{::$index}}"
                           value=""
                           placeholder="Kod"
                           class='diagnose-code col-xs-11 form-control'
                           ng-class="{'fielderror' : hasValidationError('diagnoskod', $index)}"
                           ng-model="diagnos.diagnosKod"
                           ng-change="onDiagnoseCodeChanged($index)"
                           uib-typeahead="d.value as d.label for d in getDiagnoseCodes(diagnosViewState.diagnosKodSystem, $viewValue) | limitTo:10"
                           typeahead-min-length="3"
                           typeahead-editable="false"
                           typeahead-on-select="onDiagnoseCodeSelect($index, $item)"
                           typeahead-template-url="/web/webjars/common/webcert/utkast/unified-edit/components/ueDiagnos/ueDiagnos.typeahead_template.html"
                           typeahead-loading="diagnosKodLoading[$index]"
                           typeahead-no-results="diagnosKodNoResults[$index]"
                           ng-blur="onBlurDiagnoseCodeField($index); validate()"
                           maxlength="4000">
                    <img src="/img/ajax-loader-kit-16x16.gif" class="diagnos-loading" ng-if="diagnosKodLoading[$index]" />
                </div>
                <span ng-if="diagnosKodNoResults[$index] && form['diagnoseCode'+$index].$viewValue.length > 2" uib-dropdown uib-dropdown-toggle
                      auto-close="disabled" is-open="true">
                      <ul uib-dropdown-menu>
                            <li><a href>Inga matchande diagnoser funna</a></li>
                      </ul>
                </span>
                <span ng-if="form['diagnoseCode'+$index].$viewValue.length > 0 && form['diagnoseCode'+$index].$viewValue.length < 3" uib-dropdown
                      uib-dropdown-toggle auto-close="disabled" is-open="true">
                      <ul uib-dropdown-menu>
                            <li><a href>Ange 3 tecken för att söka diagnoskod</a></li>
                      </ul>
                </span>
            </td>
            <td class="diagnosDescriptionColumn">
                <input type="text" class="col-xs-12 form-control maxwidth" ng-attr-id="diagnoseDescription-{{::$index|ueDomIdFilter}}"
                       ng-class="{'fielderror' : hasValidationError('diagnosbeskrivning', $index)}"
                       name="diagnose.description"
                       value=""
                       placeholder="Diagnos"
                       ng-model= "diagnos.diagnosBeskrivning"
                       ng-blur="validate()"
                       ng-change="onDiagnoseDescriptionChanged($index)"
                       uib-typeahead="d.value as d.label for d in searchDiagnoseByDescription(diagnosViewState.diagnosKodSystem, $viewValue)"
                       typeahead-on-select="onDiagnoseDescriptionSelect($index, $item)"
                       typeahead-template-url="/web/webjars/common/webcert/utkast/unified-edit/components/ueDiagnos/ueDiagnos.typeahead_template.html"
                       typeahead-wait-ms="100"
                       maxlength="81">
            </td>
        </tr>
    </table>
    <wc-field-validation field-type="{{options.type}}" validations="diagnosValidations"></wc-field-validation>
</ng-form>
