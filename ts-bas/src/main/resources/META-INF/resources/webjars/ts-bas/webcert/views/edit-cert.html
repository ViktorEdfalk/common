<!--

    Copyright (C) 2013 Inera AB (http://www.inera.se)

    This file is part of Inera Certificate Modules (http://code.google.com/p/inera-certificate-modules).

    Inera Certificate Modules is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as
    published by the Free Software Foundation, either version 3 of the
    License, or (at your option) any later version.

    Inera Certificate Modules is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

-->

<a id="top"></a>
<div class="container-fluid">
  <div class="row">
    <div class="col-md-12 webcert-col webcert-col-single">

      <div wc-print-header title-id="ts-bas.label.certtitle"></div>

      <div class="header-fix-top print-hide">
        <div class="header-wrapper" ng-hide="widgetState.collapsedHeader" ng-animate="'menucollapse'">
          <div id="wcHeader" wc-header default-active="index"></div>
        </div>

        <div ng-hide="widgetState.activeErrorMessageKey">
          <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
               show-content="widgetState.doneLoading">

            <div class="header-fix-panel">
              <div class="header-fix-top-expand">
                <div class="header-fix-top-expand-wrapper">
                  <button class="btn btn-link" ng-click="toggleHeader()"><span
                      ng-if="widgetState.collapsedHeader">Visa</span><span
                      ng-if="!widgetState.collapsedHeader">DÃ¶lj</span> meny
                  </button>
                </div>
              </div>
              <a class="backlink-icon" href="/web/dashboard#/create" title="Tillbaka till Skriv intyg"></a>

              <h1 style="display: inline-block; margin-right: 20px;"><span message key="ts-bas.label.certtitle"></span>
              </h1>

              <div class="inline-block">
                <label class="control-label">{{cert.patient.fullstandigtNamn}} - {{cert.patient.personid}}</label>
              </div>
              <div class="form-group buttonbar">
                <button id="spara-utkast" class="btn btn-info" ng-click="save()" ng-if="!isSigned"><span message key="ts-bas.label.spara-utkast"></span></button>
                <button id="ta-bort-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned" ng-click="discard()"><span message key="ts-bas.label.ta-bort-utkast"></span></button>
                <button id="skriv-ut-utkast" class="btn btn-default btn-secondary" ng-if="!isSigned" ng-click="print()"><span message key="ts-bas.label.skriv-ut-utkast"></span></button>
                <button class="btn btn-default btn-secondary" ng-disabled="!hasSavedThisSession" ng-if="!widgetState.showComplete && !isComplete"
                        ng-click="toggleShowComplete()"><span message key="ts-bas.label.visa-kompletteras"></span>
                </button>
                <button class="btn btn-default btn-secondary" ng-disabled="!hasSavedThisSession" ng-if="widgetState.showComplete && !isComplete"
                        ng-click="toggleShowComplete()"><span message key="ts-bas.label.dolj-kompletteras"></span>
                </button>
              </div>
              <div id="certificate-is-sent-to-it-message-text" ng-show="isSigned"><strong><span message key="ts-bas.label.status"></span></strong>
              	<span message key="ts-bas.label.status.intyget-signerat"></span>
              </div>
              <div ng-show="certForm.$pristine && isComplete && !isSigned"><strong><span message key="ts-bas.label.status"></span></strong>
              	<span message key="ts-bas.label.status.intyget-sparat"></span>
              </div>
              <div ng-show="certForm.$pristine && !isComplete"><strong><span message key="ts-bas.label.status"></span></strong>
              	<span message key="ts-bas.label.status.intyget-sparat-ejkomplett"></span>
              </div>
              <div ng-show="certForm.$dirty"><strong><span message key="ts-bas.label.status"></span></strong><span message key="ts-bas.label.status.intyget-inte-sparat"></span></div>
            </div>
          </div>
        </div>
      </div>
      <!-- top end -->

      <!-- Total fail error messages -->
      <div class="cert-error-panel" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey">
        <div class="alert alert-danger">
          <span message key="{{widgetState.activeErrorMessageKey}}"></span>
        </div>
      </div>

      <!-- TS-BAS -->
      <div class="edit-form" ng-class="{'collapsed' : widgetState.collapsedHeader}">

        <form name="certForm" novalidate autocomplete="off">
          <div ng-hide="widgetState.activeErrorMessageKey">

            <div wc-spinner label="info.loadingdata" show-spinner="!widgetState.doneLoading"
                 show-content="widgetState.doneLoading">

              <div class="alert alert-danger" ng-show="widgetState.showComplete && !isComplete"
                   style="margin-right: 20px">
                <h3><span message key="ts-bas.label.komplettera-falt"></span></h3>
                <ul>
                  <li ng-repeat="message in validationMessages">
                    <span message key="{{message.message}}"></span></li>
                </ul>
              </div>

              <div id="certificate" class="row certificate">
                <div class="col-md-12 cert-body">

                  <div wc-field field-label="ts-bas.label.intygavser" field-help-text="ts-bas.helptext.intyg-avser">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.intygavser">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.intygavser"><span message
                                                                                              key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <p><span message key="ts-bas.text.information-om-intyg"></span><span wc-enable-tooltip
                                                                             field-help-text="ts-bas.helptext.intyg-avser.grupp2-grupp3"></span>
                    </p>

                    <p><span message key="ts-bas.text.information-om-begart-lakarintyg"></span></p>

                    <div class="form-group clearfix">
                      <label class="checkbox checkbox-columns col-xs-2"
                             ng-repeat="typ in cert.intygAvser.korkortstyp track by $index"><input
                          id="typcheck{{$index}}" name="typcheck{{$index}}" type="checkbox" ng-model="typ.selected">
                        <span message key="ts-bas.label.korkort.{{typ.type}}"></span></label>
                    </div>
                  </div>

                  <div wc-field field-label="ts-bas.label.identitet">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.identitet">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.identitet"><span message
                                                                                             key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>
                    <div class="form-group clearfix">
                      <label class="radio checkbox-columns col-xs-6" ng-repeat="v in form.identity"><input
                          name="identity{{$index}}" type="radio" value="{{v.id}}" ng-model="cert.vardkontakt.idkontroll">
                        {{v.label}}</label>
                    </div>
                    <div class="alert alert-info">
	                    <span message key="ts-bas.helptext.identitet-styrkt-genom.id-kort"></span><br>
	                    <span message key="ts-bas.helptext.identitet-styrkt-genom.foretags-tjanstekort"></span><br>
	                    <span message key="ts-bas.helptext.identitet-styrkt-genom.forsakran-enl18kap4"></span><br>
	                    <span message key="ts-bas.helptext.identitet-styrkt-genom.pass"></span><br>
	                </div>
                  </div>
				  
				          <div class="alert alert-info print-pagebreak-after">
                    <span message key="ts-bas.helptext.lakaren-ska-uppmarksamma"></span>
                  </div>

                  <!-- 1. Syn -->
                  <div wc-field field-label="ts-bas.label.synfunktioner" field-has-errors="testerror" ng-form
                       name="synForm">

                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.syn">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.syn"><span message
                                                                                             key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="synay" name="synay" type="radio" ng-value="true"
                                   ng-model="cert.syn.synfaltsdefekter"></td>
                        <td><input id="synan" name="synan" type="radio" ng-value="false"
                                   ng-model="cert.syn.synfaltsdefekter"></td>
                        <td><span message key="ts-bas.label.syn.synfaltsdefekter"></span></td>
                      </tr>
                      <tr>
                        <td><input id="synby" name="synby" type="radio" ng-value="true"
                                   ng-model="cert.syn.nattblindhet"></td>
                        <td><input id="synbn" name="synbn" type="radio" ng-value="false"
                                   ng-model="cert.syn.nattblindhet"></td>
                        <td><span message key="ts-bas.label.syn.nattblindhet"></span></td>
                      </tr>
                      <tr>
                        <td><input id="syncy" name="syncy" type="radio" ng-value="true"
                                   ng-model="cert.syn.progressivOgonsjukdom">
                        </td>
                        <td><input id="syncn" name="syncn" type="radio" ng-value="false"
                                   ng-model="cert.syn.progressivOgonsjukdom">
                        </td>
                        <td>
                          <p><span message key="ts-bas.label.syn.progressivogonsjukdom"></span></p>

                          <div class="alert alert-info" ng-if="cert.syn.progressivOgonsjukdom || cert.syn.nattblindhet || cert.syn.synfaltsdefekter">
                            <span message key="ts-bas.helptext.synfunktioner.om-nagon-av-a-c"></span>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td><input id="syndy" name="syndy" type="radio" ng-value="true" ng-model="cert.syn.diplopi">
                        </td>
                        <td><input id="syndn" name="syndn" type="radio" ng-value="false" ng-model="cert.syn.diplopi">
                        </td>
                        <td><span message key="ts-bas.label.syn.diplopi"></span></td>
                      </tr>
                      <tr>
                        <td><input id="syney" name="syney" type="radio" ng-value="true" ng-model="cert.syn.nystagmus">
                        </td>
                        <td><input id="synen" name="synen" type="radio" ng-value="false" ng-model="cert.syn.nystagmus">
                        </td>
                        <td><span message key="ts-bas.label.syn.nystagmus"></span></td>
                      </tr>
                      <tr>
                        <td></td>
                        <td></td>
                        <td><p><span message key="ts-bas.label.syn.synskarpa"></span></p>
                          <div class="alert alert-info">
                            <span message key="ts-bas.helptext.synfunktioner.synskarpa"></span>
                          </div>

                          <table class="table table-form">
                            <tr>
                              <th></th>
                              <th><span message key="ts-bas.label.syn.utan-korrektion"></span><span wc-enable-tooltip
                                                        field-help-text="ts-bas.helptext.synfunktioner.utan-korrektion" />
                              </th>
                              <th><span message key="ts-bas.label.syn.med-korrektion"></span><span wc-enable-tooltip
                                                       field-help-text="ts-bas.helptext.synfunktioner.med-korrektion" />
                              </th>
                              <th><span message key="ts-bas.label.syn.kontaktlinster"></span></th>
                            </tr>
                            <tr>
                              <td><span message key="ts-bas.label.syn.hoger-oga"></span></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.hogerOga.utanKorrektion"></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.hogerOga.medKorrektion"></td>
                              <td><input type="checkbox" ng-model="cert.syn.hogerOga.kontaktlins"></td>
                            </tr>
                            <tr>
                              <td><span message key="ts-bas.label.syn.vanster-oga"></span></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.vansterOga.utanKorrektion"></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.vansterOga.medKorrektion"></td>
                              <td><input type="checkbox" ng-model="cert.syn.vansterOga.kontaktlins"></td>
                            </tr>
                            <tr>
                              <td><span message key="ts-bas.label.syn.binokulart"></span></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.binokulart.utanKorrektion"></td>
                              <td><input type="text" class="form-control small-decimal" wc-eye-decimal
                                         ng-model="cert.syn.binokulart.medKorrektion"></td>
                              <td></td>
                            </tr>
                          </table>

                          <h4><span message key="ts-bas.label.syn.korrektionsglasens-styrka"></span></h4>
                          <label class="checkbox"><input name="dioptrier" type="checkbox"
                                                         ng-model="cert.syn.korrektionsglasensStyrka"><span message key="ts-bas.label.syn.8-dioptrier"></span></label>

                          <div class="alert alert-info" ng-show="cert.syn.korrektionsglasensStyrka == true">
                            <span message key="ts-bas.helptext.synfunktioner.info-8-dioptrier"></span>
                          </div>

                        </td>
                      </tr>
                    </table>
                  </div>

                  <!-- 2 -->
                  <div wc-field field-label="ts-bas.label.horselbalans">

                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.horselbalans">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.horselbalans"><span message
                                                                                                      key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="horselbalansay" name="horselbalansay" type="radio" ng-value="true"
                                   ng-model="cert.horselBalans.balansrubbningar"></td>
                        <td><input id="horselbalansan" name="horselbalansan" type="radio" ng-value="false"
                                   ng-model="cert.horselBalans.balansrubbningar"></td>
                        <td><span message key="ts-bas.label.horselbalans.balansrubbningar"></span></td>
                      </tr>
                      <tr ng-show="form.korkortd">
                        <td><input id="horselbalansby" name="horselbalansby" type="radio" ng-value="true"
                                   ng-model="cert.horselBalans.svartUppfattaSamtal4Meter"></td>
                        <td><input id="horselbalansbn" name="horselbalansbn" type="radio" ng-value="false"
                                   ng-model="cert.horselBalans.svartUppfattaSamtal4Meter"></td>
                        <td><span message key="ts-bas.label.horselbalans.uppfatta-vanlig-samtalsstamma"></span></td>
                      </tr>
                    </table>
                  </div>

                  <!-- 3 -->
                  <div wc-field field-label="ts-bas.label.funktionsnedsattning">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.funktionsnedsattning">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.funktionsnedsattning"><span message
                                                                                                              key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="funktionsnedsattningay" name="funktionsnedsattningay" type="radio"
                                   ng-value="true" ng-model="cert.funktionsnedsattning.funktionsnedsattning"></td>
                        <td><input id="funktionsnedsattningan" name="funktionsnedsattningan" type="radio"
                                   ng-value="false" ng-model="cert.funktionsnedsattning.funktionsnedsattning"></td>
                        <td><p><span message key="ts-bas.label.funktionsnedsattning.funktionsnedsattning"></span></p>

                          <div data-ng-show="cert.funktionsnedsattning.funktionsnedsattning">
                            <p><span message key="ts-bas.label.funktionsnedsattning.beskrivning"></span></p>
                            <textarea id="funktionsnedsattning" class="form-control" name="funktionsnedsattning"
                                      rows='5' wc-maxlength maxlength="{{inputLimits.funktionsnedsattning}}"
                                      ng-model="cert.funktionsnedsattning.beskrivning"></textarea>
                          </div>
                        </td>
                      </tr>
                      <tr ng-show="form.korkortd">
                        <td><input id="funktionsnedsattningby" name="funktionsnedsattningby" type="radio"
                                   ng-value="true" ng-model="cert.funktionsnedsattning.otillrackligRorelseformaga"></td>
                        <td><input id="funktionsnedsattningbn" name="funktionsnedsattningbn" type="radio"
                                   ng-value="false" ng-model="cert.funktionsnedsattning.otillrackligRorelseformaga">
                        </td>
                        <td><span message key="ts-bas.label.funktionsnedsattning.rorelsformaga"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.hjartkarl">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.hjartkarl">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.hjartkarl"><span message
                                                                                                   key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="hjartkarlay" name="hjartkarlay" type="radio" ng-value="true"
                                   ng-model="cert.hjartKarl.hjartKarlSjukdom"></td>
                        <td><input id="hjartkarlan" name="hjartkarlan" type="radio" ng-value="false"
                                   ng-model="cert.hjartKarl.hjartKarlSjukdom"></td>
                        <td><span message key="ts-bas.label.hjartkarl.hjart-karlsjukdom"></span></td>
                      </tr>
                      <tr>
                        <td><input id="hjartkarlby" name="hjartkarlby" type="radio" ng-value="true"
                                   ng-model="cert.hjartKarl.hjarnskadaEfterTrauma"></td>
                        <td><input id="hjartkarlbn" name="hjartkarlbn" type="radio" ng-value="false"
                                   ng-model="cert.hjartKarl.hjarnskadaEfterTrauma"></td>
                        <td><span message key="ts-bas.label.hjartkarl.hjarnskada-efter-trauma"></span></td>
                      </tr>
                      <tr>
                        <td><input id="hjartkarlcy" name="hjartkarlcy" type="radio" ng-value="true"
                                   ng-model="cert.hjartKarl.riskfaktorerStroke"></td>
                        <td><input id="hjartkarlcn" name="hjartkarlcn" type="radio" ng-value="false"
                                   ng-model="cert.hjartKarl.riskfaktorerStroke"></td>
                        <td><p><span message key="ts-bas.label.hjartkarl.riskfaktorer-stroke"></span></p>

                          <div ng-show="cert.hjartKarl.riskfaktorerStroke">
                            <p><span message key="ts-bas.label.hjartkarl.riskfaktorer-stroke.beskrivning"></span></p>
                            <textarea class="form-control" ng-model="cert.hjartKarl.beskrivningRiskfaktorer"
                                      wc-maxlength maxlength="{{inputLimits.beskrivningRiskfaktorer}}"></textarea>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.diabetes">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.diabetes">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.diabetes"><span message
                                                                                                  key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="diabetesay" name="diabetesay" type="radio" ng-value="true"
                                   ng-model="cert.diabetes.harDiabetes"></td>
                        <td><input id="diabetesan" name="diabetesan" type="radio" ng-value="false"
                                   ng-model="cert.diabetes.harDiabetes"></td>
                        <td>
                          <p><span message key="ts-bas.label.diabetes.har-diabetes"></span></p>

                          <div data-ng-show="cert.diabetes.harDiabetes">
                            <p><span message key="ts-bas.label.diabetes.diabetestyp"></span>
                              <label class="radio"><input name="diabetestype1" type="radio" value="DIABETES_TYP_1"
                                                          ng-model="cert.diabetes.diabetesTyp"><span message key="ts-bas.label.diabetes.diabetestyp.diabetes_typ_1"></span></label>
                              <label class="radio"><input name="diabetestype2" type="radio" value="DIABETES_TYP_2"
                                                          ng-model="cert.diabetes.diabetesTyp"><span message key="ts-bas.label.diabetes.diabetestyp.diabetes_typ_2"></span></label>
                            </p>

                            <div data-ng-show="cert.diabetes.diabetesTyp == 'DIABETES_TYP_2'">
                              <span message key="ts-bas.label.diabetes.behandling"></span>
                              <label class="checkbox"><input name="diabetestreat1" type="checkbox"
                                                             ng-model="cert.diabetes.kost"><span message key="ts-bas.label.diabetes.behandling.kost"></span></label>
                              <label class="checkbox"><input name="diabetestreat2" type="checkbox"
                                                             ng-model="cert.diabetes.tabletter"><span message key="ts-bas.label.diabetes.behandling.tabletter"></span></label>
                              <label class="checkbox"><input name="diabetestreat3" type="checkbox"
                                                             ng-model="cert.diabetes.insulin"><span message key="ts-bas.label.diabetes.behandling.insulin"></span></label>

                              <div class="alert alert-info"
                                   data-ng-show="cert.diabetes.tabletter || cert.diabetes.insulin">
                                <span message key="ts-bas.helptext.diabetes.tabletter-eller-insulin"></span>
                              </div>

                            </div>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.neurologi">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.neurologi">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.neurologi"><span message
                                                                                                   key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="neurologiay" name="neurologiay" type="radio" ng-value="true"
                                   ng-model="cert.neurologi.neurologiskSjukdom"></td>
                        <td><input id="neurologian" name="neurologian" type="radio" ng-value="false"
                                   ng-model="cert.neurologi.neurologiskSjukdom"></td>
                        <td>
                          <p><span message key="ts-bas.label.neurologi.neurologisksjukdom"></span></p>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.medvetandestorning">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.medvetandestorning">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.medvetandestorning"><span message
                                                                                                            key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="medvetandestorningay" name="medvetandestorningay" type="radio" ng-value="true"
                                   ng-model="cert.medvetandestorning.medvetandestorning"></td>
                        <td><input id="medvetandestorningan" name="medvetandestorningan" type="radio" ng-value="false"
                                   ng-model="cert.medvetandestorning.medvetandestorning"></td>
                        <td>
                          <p><span message key="ts-bas.label.medvetandestorning.medvetandestorning"></span></p>

                          <div data-ng-show="cert.medvetandestorning.medvetandestorning">
                            <p><span message key="ts-bas.label.medvetandestorning.medvetandestorning-ange-datum-orsak"></span></p>
                            <textarea class="form-control" data-ng-model="cert.medvetandestorning.beskrivning"
                                      wc-maxlength maxlength="{{inputLimits.medvetandestorning}}"></textarea>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.njurar">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.njurar">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.njurar"><span message
                                                                                                key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="njuraray" name="njuraray" type="radio" ng-value="true"
                                   ng-model="cert.njurar.nedsattNjurfunktion"></td>
                        <td><input id="njuraran" name="njuraran" type="radio" ng-value="false"
                                   ng-model="cert.njurar.nedsattNjurfunktion"></td>
                        <td><span message key="ts-bas.label.njurar.nedsatt-njurfunktion"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.kognitivt">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.kognitivt">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.kognitivt"><span message
                                                                                                   key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input id="kognitivtay" name="kognitivtay" type="radio" ng-value="true"
                                   ng-model="cert.kognitivt.sviktandeKognitivFunktion"></td>
                        <td><input id="kognitivtan" name="kognitivtan" type="radio" ng-value="false"
                                   ng-model="cert.kognitivt.sviktandeKognitivFunktion"></td>
                        <td><span message key="ts-bas.label.kognitivt.sviktande-kognitiv-funktion"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.somn-vakenhet">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.somnvakenhet">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.somnvakenhet"><span message
                                                                                                      key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="somnvakenhetay" type="radio" ng-value="true"
                                   ng-model="cert.somnVakenhet.teckenSomnstorningar"></td>
                        <td><input name="somnvakenhetan" type="radio" ng-value="false"
                                   ng-model="cert.somnVakenhet.teckenSomnstorningar"></td>
                        <td><span message key="ts-bas.label.somn-vakenhet.tecken-somnstorningar"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.narkotika-lakemedel">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.narkotikalakemedel">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.narkotikalakemedel"><span message
                                                                                                            key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="narkotikalakemedelay" type="radio" ng-value="true"
                                   ng-model="cert.narkotikaLakemedel.teckenMissbruk"></td>
                        <td><input name="narkotikalakemedelan" type="radio" ng-value="false"
                                   ng-model="cert.narkotikaLakemedel.teckenMissbruk"></td>
                        <td><span message key="ts-bas.label.narkotika-lakemedel.tecken-missbruk"></span></td>
                      </tr>
                      <tr>
                        <td><input name="narkotikalakemedelby" type="radio" ng-value="true"
                                   ng-model="cert.narkotikaLakemedel.foremalForVardinsats"></td>
                        <td><input name="narkotikalakemedelbn" type="radio" ng-value="false"
                                   ng-model="cert.narkotikaLakemedel.foremalForVardinsats"></td>
                        <td><span message key="ts-bas.label.narkotika-lakemedel.foremal-for-vardinsats"></span></td>
                      </tr>
                      <tr data-ng-show="cert.narkotikaLakemedel.teckenMissbruk || cert.narkotikaLakemedel.foremalForVardinsats">
                        <td><input name="narkotikalakemedelb2y" type="radio" ng-value="true"
                                   ng-model="cert.narkotikaLakemedel.provtagningBehovs"></td>
                        <td><input name="narkotikalakemedelb2n" type="radio" ng-value="false"
                                   ng-model="cert.narkotikaLakemedel.provtagningBehovs"></td>
                        <td>
                          <p><span message key="ts-bas.label.narkotika-lakemedel.behov-provtagning"></span></p>

                          <div class="alert alert-info" data-ng-show="cert.narkotikaLakemedel.provtagningBehovs">
                            <span message key="ts-bas.helptext.alkohol-narkotika.provtagning" />
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td><input name="narkotikalakemedelcy" type="radio" ng-value="true"
                                   ng-model="cert.narkotikaLakemedel.lakarordineratLakemedelsbruk"></td>
                        <td><input name="narkotikalakemedelcn" type="radio" ng-value="false"
                                   ng-model="cert.narkotikaLakemedel.lakarordineratLakemedelsbruk"></td>
                        <td>
                          <p><span message key="ts-bas.label.narkotika-lakemedel.lakarordinerat-lakemedelsbruk"></span></p>

                          <div data-ng-show="cert.narkotikaLakemedel.lakarordineratLakemedelsbruk == true">
                            <p><span message key="ts-bas.label.narkotika-lakemedel.ange-lakemedel-dos"></span></p>
                            <textarea class="form-control" data-ng-model="cert.narkotikaLakemedel.lakemedelOchDos"
                                      wc-maxlength maxlength="{{inputLimits.lakemedelOchDos}}"></textarea>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.psykiskt">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.psykiskt">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.psykiskt"><span message
                                                                                                  key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="psykisktay" type="radio" ng-value="true"
                                   ng-model="cert.psykiskt.psykiskSjukdom"></td>
                        <td><input name="psykisktan" type="radio" ng-value="false"
                                   ng-model="cert.psykiskt.psykiskSjukdom"></td>
                        <td><span message key="ts-bas.label.psykiskt.psykisksjukdom"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.utvecklingsstorning">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.utvecklingsstorning">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.utvecklingsstorning"><span message
                                                                                                             key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="utvecklingsstorningay" type="radio" ng-value="true"
                                   ng-model="cert.utvecklingsstorning.psykiskUtvecklingsstorning"></td>
                        <td><input name="utvecklingsstorningan" type="radio" ng-value="false"
                                   ng-model="cert.utvecklingsstorning.psykiskUtvecklingsstorning"></td>
                        <td><span message key="ts-bas.label.utvecklingsstorning.psykisk-utvecklingsstorning"></span></td>
                      </tr>
                      <tr>
                        <td><input name="utvecklingsstorningby" type="radio" ng-value="true"
                                   ng-model="cert.utvecklingsstorning.harSyndrom"></td>
                        <td><input name="utvecklingsstorningbn" type="radio" ng-value="false"
                                   ng-model="cert.utvecklingsstorning.harSyndrom"></td>
                        <td><span message key="ts-bas.label.utvecklingsstorning.har-syndrom"></span></td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.sjukhusvard">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.sjukhusvard">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.sjukhusvard"><span message
                                                                                                     key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="sjukhusvarday" type="radio" ng-value="true"
                                   ng-model="cert.sjukhusvard.sjukhusEllerLakarkontakt"></td>
                        <td><input name="sjukhusvardan" type="radio" ng-value="false"
                                   ng-model="cert.sjukhusvard.sjukhusEllerLakarkontakt"></td>
                        <td>
                          <p><span message key="ts-bas.label.sjukhusvard.sjukhus-eller-lakarkontakt"></span></p>

                          <table data-ng-show="cert.sjukhusvard.sjukhusEllerLakarkontakt">
                            <tr>
                              <td class="col-md-6"><span message key="ts-bas.label.sjukhusvard.tidpunkt"></span></td>
                              <td class="col-md-6 table-padding-top"><input id="tidpunkt" name="tidpunkt" class="form-control" type="text"
                                         data-ng-model="cert.sjukhusvard.tidpunkt" wc-maxlength
                                         maxlength="{{inputLimits.sjukhusvardtidpunkt}}"></td>
                            </tr>
                            <tr>
                              <td class="col-md-6"><span message key="ts-bas.label.sjukhusvard.vardinrattning"></span></td>
                              <td class="col-md-6 table-padding-top"><input id="vardinrattning" name="vardinrattning" class="form-control" type="text"
                                         data-ng-model="cert.sjukhusvard.vardinrattning" wc-maxlength
                                         maxlength="{{inputLimits.sjukhusvardvardinrattning}}"></td>
                            </tr>
                            <tr>
                              <td class="col-md-6"><span message key="ts-bas.label.sjukhusvard.anledning"></span></td>
                              <td class="col-md-6 table-padding-top"><input id="anledning" name="anledning" class="form-control" type="text"
                                         data-ng-model="cert.sjukhusvard.anledning" wc-maxlength
                                         maxlength="{{inputLimits.sjukhusvardanledning}}"></td>
                            </tr>
                          </table>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.medicinering">
                    <table class="table table-form">
                      <tr ng-if="validationMessagesGrouped.medicinering">
                        <td colspan="3">
                          <div class="alert alert-danger">
                            <ul>
                              <li ng-repeat="message in validationMessagesGrouped.medicinering"><span message
                                                                                                      key="{{message.message}}"></span>
                              </li>
                            </ul>
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <th><span message key="common.yes"></span></th>
                        <th><span message key="common.no"></span></th>
                        <th class="maxwidth"></th>
                      </tr>
                      <tr>
                        <td><input name="medicineringay" type="radio" ng-value="true"
                                   ng-model="cert.medicinering.stadigvarandeMedicinering"></td>
                        <td><input name="medicineringan" type="radio" ng-value="false"
                                   ng-model="cert.medicinering.stadigvarandeMedicinering"></td>
                        <td>
                          <p><span message key="ts-bas.label.medicinering.stadigvarande-medicinering"></span></p>

                          <div data-ng-show="cert.medicinering.stadigvarandeMedicinering">
                            <p><span message key="ts-bas.label.medicinering.beskrivning"></span></p>
                            <textarea class="form-control" data-ng-model="cert.medicinering.beskrivning" wc-maxlength
                                      maxlength="{{inputLimits.medicinering}}"></textarea>
                          </div>
                        </td>
                      </tr>
                    </table>
                  </div>

                  <div wc-field field-label="ts-bas.label.ovrigkommentar">
                    <p><span message key="ts-bas.label.kommentar-relevant-trafiksakerhet"></span></p>
                    <textarea id="kommentar" class="form-control" name="kommentar" rows='5' ng-model="cert.kommentar"
                              wc-maxlength maxlength="{{inputLimits.kommentar}}"></textarea>
                    <!-- ng-change="inputlimit for IE"-->
                  </div>

                  <div wc-field field-label="ts-bas.label.bedomning" class="print-pagebreak-after" field-help-text="ts-bas.helptext.bedomning">
                    <div class="alert alert-danger" ng-if="validationMessagesGrouped.bedomning">
                      <ul>
                        <li ng-repeat="message in validationMessagesGrouped.bedomning"><span message
                                                                                             key="{{message.message}}"></span>
                        </li>
                      </ul>
                    </div>

                    <p><span message key="ts-bas.label.bedomning-info-alt-1"></span></p>

                    <div class="form-group">
                      <label class="radio"><input name="behorighetnagon" type="radio" ng-value="true"
                                                  ng-model="form.behorighet">
                        <span message key="ts-bas.label.nagon-av-foljande-behorigheter"></span></label>

                      <div class="form-group clearfix indent" data-ng-show="form.behorighet">
                        <label class="checkbox checkbox-columns col-xs-2"
                               ng-repeat="typ in cert.bedomning.korkortstyp track by $index"><input
                            id="korkortstyp{{$index}}" name="korkortstyp{{$index}}" type="checkbox"
                            ng-model="typ.selected"> <span message
                                                           key="ts-bas.label.korkort.{{typ.type}}"></span></label>
                      </div>
                      <label class="radio"><input name="behorighetinte" type="radio" ng-value="false"
                                                  ng-model="form.behorighet"> 
                        <span message key="ts-bas.label.bedomning.kan-inte-ta-stallning"></span></label>
                    </div>

                    <p ng-show="form.anyTrue">
                        <span message key="ts-bas.helptext.bedomning.info"></span>
                    </p>

                    <p ng-show="cert.syn.korrektionsglasensStyrka == true">
                            <span message key="ts-bas.helptext.synfunktioner.8-dioptrier-valt"></span>
                    </p>

                    <p data-ng-show="cert.diabetes.tabletter || cert.diabetes.insulin">
						<span message key="ts-bas.helptext.diabetes.tabletter-eller-insulin"></span>
					</p>

                    <p><span message key="ts-bas.label.bedomning-info-undersokas-med-specialkompetens"></span></p>
                    <textarea name="specialist" class="form-control" rows='2'
                              ng-model="cert.bedomning.lakareSpecialKompetens" wc-maxlength
                              maxlength="{{inputLimits.lakareSpecialKompetens}}"></textarea>
                  </div>

                  <div class="body-row clearfix">
                    <h3 class="title">
                      <span message key="ts-bas.label.unit"></span>
                    </h3>

                    <div class="text">
                      <div class="alert alert-danger" ng-if="validationMessagesGrouped.vardenhet">
                        <ul>
                          <li ng-repeat="message in validationMessagesGrouped.vardenhet"><span message
                                                                                               key="{{message.message}}"></span>
                          </li>
                        </ul>
                      </div>
                      <label class="control-label">{{cert.skapadAv.vardenhet.enhetsnamn}}
                        ({{cert.skapadAv.vardenhet.enhetsid}}),
                        {{cert.skapadAv.vardenhet.vardgivare.vardgivarnamn}}</label>

                      <div class="form-horizontal">
                        <div class="form-group">
                          <label class="col-xs-3 control-label"><span message key="ts-bas.form.postadress"></span></label>

                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfo.postalAddress"
                                   name="clinicInfo.postalAddress" ng-model="cert.skapadAv.vardenhet.postadress">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label"><span message key="ts-bas.form.postnummer"></span></label>

                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfo.postalCode"
                                   name="clinicInfo.postalCode" ng-model="cert.skapadAv.vardenhet.postnummer">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label"><span message key="ts-bas.form.postort"></span></label>

                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfo.postalCity"
                                   name="clinicInfo.postalCity" ng-model="cert.skapadAv.vardenhet.postort">
                          </div>
                        </div>
                        <div class="form-group">
                          <label class="col-xs-3 control-label"><span message key="ts-bas.form.telefonnummer"></span></label>

                          <div class="col-xs-9">
                            <input type="text" class="form-control" id="clinicInfo.phone" name="clinicInfo.phone"
                                   ng-model="cert.skapadAv.vardenhet.telefonnummer">
                          </div>
                        </div>
                        <div class="form-group" ng-if="false">
                          <label class="col-xs-3 control-label"><span message key="ts-bas.form.epost"></span></label>
                        <div class="col-xs-9">
                          <input type="text" class="form-control" id="clinicInfo.email" name="clinicInfo.email"
                                 ng-model="cert.skapadAv.epost">
                                 {{cert.skapadAv.epost}}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  <div class="body-row clearfix">
                     <div ng-if="specialiteter.length > 0">
                       <h4><span message key="ts-bas.label.specialkompetens"></span></h4>
                       <span> {{specialiteter}}</span><br/>
                     </div><br/>
                     <div ng-if="befattningar.length > 0">
                       <h4><span message key="ts-bas.label.befattningar"></span></h4>
                       <span ng-repeat="befattning in befattningar"></span>
                      </div><br/>
                   </div>
                </div>
                <!-- cert body -->

              </div>
              <!-- certificate -->

              <div ng-if="!isSigned" class="print-hide">
                <h3><span message key="ts-bas.label.signera"></span></h3>

                <div id="sign-requires-doctor-message-text" ng-if="!user.userContext.lakare" class="alert alert-info">
                  <span message key="ts-bas.validation.missing.krav-pa-lakarunderskrift"></span>
                </div>

                <button id="signera-utkast-button" class="btn btn-success" ng-disabled="!isComplete" ng-click="sign()"
                        ng-show="user.userContext.lakare">Signera intyget
                </button>
              </div>

            </div>
          </div>
        </form>
      </div>

    </div>
    <!-- span12 webcert-col-single -->
  </div>
  <!-- row -->
</div><!-- container -->
