<div class="weak-hidden" ng-class="{show: widgetState.showTemplate}" ng-controller="fk7263.ViewCertCtrl">
  <div wc-spinner label="fk7263.info.loadingcertificate" show-spinner="!widgetState.doneLoading"
       show-content="widgetState.doneLoading">

    <div wc-print-header title-id="fk7263.label.certtitle" print-message-id="print.label.{{widgetState.printStatus}}"
         intygs-id="cert.id"></div>

    <!-- error message -->
    <div id="cert-load-error" ng-show="widgetState.doneLoading && widgetState.activeErrorMessageKey"
         class="alert alert-danger alert-column print-hide">

      <p>
        <span message key="fk7263.{{widgetState.activeErrorMessageKey}}"></span>
      </p>

      <div
          ng-if="intygBackup.showBackupInfo && intygBackup.intyg != undefined && intygBackup.intyg.intygsId != undefined">
        <p><strong>Intygsinformation</strong></p>
        <ul>
          <li>Patient: {{intygBackup.intyg.patientNamn}} ({{intygBackup.intyg.patientId.patientIdExtension}})</li>
          <li>Signerat: {{intygBackup.intyg.signeringsDatum | date:'short'}}</li>
          <li>ID: {{intygBackup.intyg.intygsId}}</li>
        </ul>
      </div>
    </div>
    <div ng-show="!widgetState.activeErrorMessageKey" id="intyg-vy-laddad">

      <div class="print-hide">
        <div class="form-group buttonbar">
          <label class="control-label">{{cert.intygMetadata.patient.fullstandigtNamn}} - {{cert.intygMetadata.patient.personId}}</label>

          <form id="view-as-pdf" action="{{pdfUrl}}" method="get" target="_blank" name="pdfForm">
            <p class="btn-row">
              <button id="sendBtn" class="btn btn-info" ng-if="!certProperties.isSent && !certProperties.isRevoked && !isQaOnly"
                      wc-feature-active feature="skickaIntyg" intygstyp="fk7263"
                      ng-click="send(cert)">Skicka tillFörsäkringskassan
              </button>
              <button id="downloadprint" type="submit" value="submit" class="btn btn-info" ng-click="print(cert)">Skriv
                ut
              </button>
              <button id="copyBtn" class="btn btn-info" ng-if="!certProperties.isRevoked && !isQaOnly" ng-click="copy(cert)"
                      wc-feature-active feature="kopieraIntyg" intygstyp="fk7263"
                      title="Kopiera intyg innebär att en kopia skapas av det befintliga intyget och med samma information.
I de fall patienten har ändrat namn eller adress så uppdateras den informationen.
Uppgifterna i intygsutkastet går att ändra innan det signeras.
Kopiera intyg kan användas exempelvis vid förlängning av en sjukskrivning.">
                Kopiera
              </button>
              <button id="makuleraBtn" class="btn btn-inverse" ng-if="!certProperties.isRevoked && !isQaOnly" ng-click="makulera(cert)"
                      wc-feature-active feature="makuleraIntyg" intygstyp="fk7263"
                      title="Makulera intyg innebär att intyget återtas. Vid behov kan intyget ersättas med ett nytt.">
                Makulera
              </button>
            </p>
          </form>
        </div>


        <div class="alert alert-info alert-column" ng-if="!certProperties.isRevoked">
          <strong>Status:</strong>
          <span ng-if="certProperties.isSent" id="certificate-is-sent-to-recipient-message-text">Intyget är signerat och mottaget av Försäkringskassans system.</span>
          <span ng-if="!certProperties.isSent" id="certificate-is-sent-to-it-message-text">
            Intyget är signerat. Intyget är nu tillgängligt för invånaren i webbtjänsten Mina intyg, som nås via 1177.se. Intyget går även att nå via Försäkringskassans e-tjänst för ansökan om sjukpenning.
            Om patienten inte har möjlighet att skicka intyget elektroniskt till Försäkringskassan kan du skicka intyget direkt till Försäkringskassan åt patienten. Observera att patientens samtycke då krävs.
          </span>
        </div>
        <div ng-if="certProperties.isRevoked" id="certificate-is-revoked-message-text" class="alert alert-warning"
             style="margin-right: 20px; max-width: 530px;">Intyget är makulerat
        </div>
      </div>

      <div id="certificate" ng-class="{'certificate': true, 'revoked-certificate' : certProperties.isRevoked}">
        <div class="row">
          <div class="col-md-12">
            <div class="cert-body">

              <div wc-field field-number="1" field-label="fk7263.label.smittskydd" filled="{{true}}">
                <span ng-show="cert.avstangningSmittskydd" id="smittskydd"> <span message key="fk7263.label.yes"></span></span>
                <span ng-show="!cert.avstangningSmittskydd"> <span message key="fk7263.label.no"></span></span>
              </div>

              <div wc-field field-number="2" field-label="fk7263.label.diagnos"
                   filled="{{cert.diagnosKod!=null}}" id="field2">
                <div class="form-group">
                  <span id="diagnosBeskrivning">{{cert.diagnosBeskrivning}}</span> (<span class="tag"><span message
                                                                       key="fk7263.label.diagnoskod"></span></span>
                  <span id="diagnosKod">{{cert.diagnosKod}}</span><span id="diagnosBeskrivning1"> {{cert.diagnosBeskrivning1}}</span>)
                </div>
                <div class="form-group">
                  <label class="control-label bold"
                         ng-show="cert.diagnosKod2 || cert.diagnosBeskrivning2 || cert.diagnosKod3 || cert.diagnosBeskrivning3">
                    <span message key="fk7263.label.ytterligarediagnoser"></span>
                  </label>
                  <div class="controls">
                    <p ng-show="cert.diagnosKod2 || cert.diagnosBeskrivning2 "><span id="diagnosKod2">{{cert.diagnosKod2}}</span>
                      <span id="diagnosBeskrivning2">{{cert.diagnosBeskrivning2}}</span></p>
                    <p ng-show="cert.diagnosKod3 || cert.diagnosBeskrivning3"><span id="diagnosKod3">{{cert.diagnosKod3}}</span>
                      <span id="diagnosBeskrivning3">{{cert.diagnosBeskrivning3}}</span></p>
                    <div id="samsjuklighet" ng-show="cert.samsjuklighet" class="bold"><span message
                                                                         key="fk7263.label.samsjuklighet"></span></div>
                  </div>
                </div>
              </div>

              <div wc-field field-number="3" field-label="fk7263.label.aktuellt-sjukdomsforlopp"
                   filled="{{cert.sjukdomsforlopp!=null}}"><span id="sjukdomsforlopp">{{cert.sjukdomsforlopp}}</span>
              </div>

              <div wc-field field-number="4" field-label="fk7263.label.funktionsnedsattningar"
                   filled="{{cert.funktionsnedsattning!=null}}"><span id="funktionsnedsattning">{{cert.funktionsnedsattning}}</span>
              </div>

              <div wc-field field-number="4b" field-label="fk7263.label.intyg-baserat-pa" id="field4b"
                   filled="{{cert.undersokningAvPatienten!=null || telefonkontaktMedPatienten!=null || cert.journaluppgifter!=null || cert.annanReferens!=null}}">
                <ul>
                  <li ng-show="cert.undersokningAvPatienten!=null"><span message
                                                                         key="fk7263.vardkontakt.undersokning"></span><span id="undersokningAvPatienten">{{cert.undersokningAvPatienten
                    | date:'longDate' }}</span>
                  </li>
                  <li ng-show="cert.telefonkontaktMedPatienten!=null"><span message
                                                                            key="fk7263.vardkontakt.telefonkontakt"></span><span id="telefonkontaktMedPatienten">{{cert.telefonkontaktMedPatienten
                    | date:'longDate' }}</span>
                  </li>
                  <li ng-show="cert.journaluppgifter!=null"><span message key="fk7263.referens.journal"></span><span id="journaluppgifter">{{cert.journaluppgifter
                    | date:'longDate' }}</span>
                  </li>

                  <li ng-show="cert.annanReferens!=null">
                    <!-- Annat -->
                    <span message key="fk7263.referens.annat"></span> {{cert.annanReferens | date:'longDate'}}:
                    <span id="annanReferensBeskrivning">{{cert.annanReferensBeskrivning}}</span>
                  </li>
                </ul>
              </div>

              <div wc-field field-number="5" field-label="fk7263.label.aktivitetsbegransning"
                   filled="{{cert.aktivitetsbegransning!=null}}"><span id="aktivitetsbegransning">{{cert.aktivitetsbegransning}}</span>
              </div>

              <div wc-field field-number="6a" field-label="fk7263.label.rekommendationer" id="field6a"
                   filled="{{cert.rekommendationKontaktArbetsformedlingen || cert.rekommendationKontaktForetagshalsovarden || cert.rekommendationOvrigt!=null}}">
                <ul>
                  <li id="rekommendationKontaktArbetsformedlingen" ng-show="cert.rekommendationKontaktArbetsformedlingen"><span message
                                                                                   key="fk7263.label.rekommendationer.kontakt.arbetsformedlingen"></span>
                  </li>
                  <li id="rekommendationKontaktForetagshalsovarden" ng-show="cert.rekommendationKontaktForetagshalsovarden"><span message
                                                                                    key="fk7263.label.rekommendationer.kontakt.foretagshalsovarden"></span>
                  </li>
                  <li ng-show="cert.rekommendationOvrigt"><span message
                                                                key="fk7263.label.rekommendationer.kontakt.ovrigt"></span>
                    <span id="rekommendationOvrigt">{{cert.rekommendationOvrigt}}</span>
                  </li>
                </ul>
              </div>

              <div wc-field field-number="6b" field-label="fk7263.label.planerad-atgard"
                   filled="{{cert.atgardInomSjukvarden!=null||cert.annanAtgard!=null}}" id="field6b">
                <ul>
                  <li ng-show="cert.atgardInomSjukvarden != null"><span message
                                                                        key="fk7263.label.planerad-atgard.sjukvarden"></span>
                    <span id="atgardInomSjukvarden">{{cert.atgardInomSjukvarden}}</span>
                  </li>
                  <li ng-show="cert.annanAtgard != null"><span message key="fk7263.label.planerad-atgard.annat"></span>
                    <span id="annanAtgard">{{cert.annanAtgard}}</span>
                  </li>
                </ul>
              </div>

              <div wc-field field-number="7" field-label="fk7263.label.rehabilitering-aktuell"
                   filled="{{cert.rehabiliteringAktuell||cert.rehabiliteringEjAktuell||cert.rehabiliteringGarInteAttBedoma}}"
                   id="field7" class="print-pagebreak-after">
                <span id="rehabiliteringAktuell" ng-show="cert.rehabiliteringAktuell"><span message key="fk7263.label.yes"></span></span>
                <span id="rehabiliteringEjAktuell" ng-show="cert.rehabiliteringEjAktuell"><span message key="fk7263.label.no"></span></span>
                <span id="rehabiliteringGarInteAttBedoma" ng-show="cert.rehabiliteringGarInteAttBedoma"><span message key="fk7263.label.gar-ej-att-bedomma"></span></span>
              </div>

              <div wc-field field-number="8a" field-label="fk7263.label.arbetsformaga"
                   filled="{{cert.nuvarandeArbetsuppgifter||cert.arbetsloshet||cert.foraldrarledighet}}" id="field8">
                <ul>
                  <li ng-show="cert.nuvarandeArbetsuppgifter"><span message
                                                                    key="fk7263.label.arbetsformaga.nuvarande-arbete"></span>
                    <span id="nuvarandeArbetsuppgifter">{{cert.nuvarandeArbetsuppgifter}}</span>
                  </li>
                  <li id="arbetsloshet" ng-show="cert.arbetsloshet"><span message key="fk7263.label.arbetsformaga.arbetslos"></span></li>
                  <li id="foraldrarledighet" ng-show="cert.foraldrarledighet"><span message
                                                             key="fk7263.label.arbetsformaga.foraldrarledighet"></span>
                  </li>
                </ul>
              </div>

              <div wc-field field-number="8b" field-label="fk7263.label.nedsattning"
                   filled="{{cert.nedsattMed25!=null||cert.nedsattMed50!=null||cert.nedsattMed75!=null||cert.nedsattMed100!=null}}"
                   id="field8b">

                <div ng-show="cert.nedsattMed25 != null">
                  <strong><span message key="fk7263.nedsattningsgrad.nedsatt_med_1_4"></span></strong><br> Från och med
                  <span id="nedsattMed25from">{{cert.nedsattMed25.from | date:'longDate'}}</span> &ndash; längst till och med
                  <span id="nedsattMed25tom">{{cert.nedsattMed25.tom | date:'longDate'}}</span>
                  <div id="nedsattMed25Beskrivning" ng-show="cert.nedsattMed25Beskrivning">Arbetstidsförläggning: {{cert.nedsattMed25Beskrivning}}
                  </div>
                </div>

                <div ng-show="cert.nedsattMed50 != null">
                  <strong><span message key="fk7263.nedsattningsgrad.nedsatt_med_1_2"></span></strong><br> Från och med
                  <span id="nedsattMed50from">{{cert.nedsattMed50.from | date:'longDate'}}</span> &ndash; längst till och med
                  <span id="nedsattMed50tom">{{cert.nedsattMed50.tom | date:'longDate'}}</span>
                  <div id="nedsattMed50Beskrivning" ng-show="cert.nedsattMed50Beskrivning">Arbetstidsförläggning: {{cert.nedsattMed50Beskrivning}}
                  </div>
                </div>

                <div ng-show="cert.nedsattMed75 != null">
                  <strong><span message key="fk7263.nedsattningsgrad.nedsatt_med_3_4"></span></strong><br> Från och med
                  <span id="nedsattMed75from">{{cert.nedsattMed75.from | date:'longDate'}}</span> &ndash; längst till och med
                  <span id="nedsattMed75tom">{{cert.nedsattMed75.tom | date:'longDate'}}</span>
                  <div id="nedsattMed75Beskrivning" ng-show="cert.nedsattMed75Beskrivning">Arbetstidsförläggning: {{cert.nedsattMed75Beskrivning}}
                  </div>
                </div>

                <div ng-show="cert.nedsattMed100 != null">
                  <strong><span message key="fk7263.nedsattningsgrad.helt_nedsatt"></span></strong><br> Från och med
                  <span id="nedsattMed100from">{{cert.nedsattMed100.from | date:'longDate'}}</span> &ndash; längst till och med
                  <span id="nedsattMed100tom">{{cert.nedsattMed100.tom | date:'longDate'}}</span>
                </div>

              </div>

              <div wc-field field-number="9" field-label="fk7263.label.arbetsformaga.bedomning"
                   filled="{{cert.arbetsformagaPrognos!=null}}"><span id="arbetsformagaPrognos">{{cert.arbetsformagaPrognos}}</span>
              </div>

              <div wc-field field-number="10" field-label="fk7263.label.prognos"
                   filled="{{cert.arbetsformataPrognosJa || cert.arbetsformataPrognosJaDelvis||cert.arbetsformataPrognosNej||cert.arbetsformataPrognosGarInteAttBedoma}}"
                   id="field10">

                <span id="arbetsformataPrognosJa" ng-show="cert.arbetsformataPrognosJa"><span message key="fk7263.label.yes"></span></span>
                <span id="arbetsformataPrognosJaDelvis" ng-show="cert.arbetsformataPrognosJaDelvis"><span message key="fk7263.label.delvis"></span></span>
                <span id="arbetsformataPrognosNej" ng-show="cert.arbetsformataPrognosNej"><span message key="fk7263.label.no"></span></span>
                <span id="arbetsformataPrognosGarInteAttBedoma" ng-show="cert.arbetsformataPrognosGarInteAttBedoma">
                  <span message key="fk7263.label.gar-ej-att-bedomma"></span>
                  <br>
                  <span class="tag">Förtydligande: <span id="arbetsformagaPrognosGarInteAttBedomaBeskrivning">{{cert.arbetsformagaPrognosGarInteAttBedomaBeskrivning}}</span></span>
                </span>
              </div>

              <div wc-field field-number="11" field-label="fk7263.label.resor-till-arbetet"
                   filled="{{cert.ressattTillArbeteAktuellt || cert.ressattTillArbeteEjAktuellt}}" id="field11">
                <span id="ressattTillArbeteAktuellt" ng-show="cert.ressattTillArbeteAktuellt"> <span message key="fk7263.label.yes"></span></span>
                <span id="ressattTillArbeteEjAktuellt" ng-show="cert.ressattTillArbeteEjAktuellt"> <span message key="fk7263.label.no"></span></span>
              </div>

              <div wc-field field-number="12" field-label="fk7263.label.kontakt-med-fk" filled="{{true}}" id="field12">
                <span id="kontaktMedFk" ng-show="cert.kontaktMedFk"> <span message key="fk7263.label.yes"></span></span>
                <span ng-show="!cert.kontaktMedFk"> <span message key="fk7263.label.no"></span></span>
              </div>

              <div wc-field field-number="13" field-label="fk7263.label.ovrigt" filled="{{cert.kommentar}}"
                   id="field13">
                <div class="tag" id="kommentar">{{cert.kommentar}}</div>
              </div>

              <div wc-field field-label="fk7263.label.arbetsplatskod" field-number="17"
                   filled="{{cert.forskrivarkodOchArbetsplatskod!=null}}" id="field17">
                <!--  leave  as div tag for IE8 magic bug. using span crashes angular.. -->
                <div id="forskrivarkodOchArbetsplatskod">{{cert.forskrivarkodOchArbetsplatskod}}</div>
              </div>

              <div class="infobox">
                <h3>
                  <span message key="common.label.ovanstaende-har-bekraftats"></span>
                </h3>
                <h4>
                  <span message key="fk7263.label.datum"></span>
                </h4>
                <p id="signeringsdatum">{{cert.intygMetadata.signeringsdatum | date:'longDate'}}</p>
                <h4>
                  <span message key="fk7263.label.kontakt-info"></span>
                </h4>
                <p>
                  <span class="text" id="vardperson_namn">{{cert.intygMetadata.skapadAv.fullstandigtNamn}}</span><br>
                  <span class="text" id="vardperson_enhetsnamn">{{cert.intygMetadata.skapadAv.vardenhet.enhetsnamn}}</span><br>
                  <span class="text" id="vardperson_postadress">{{cert.intygMetadata.skapadAv.vardenhet.postadress}}</span><br>
                  <span class="text"><span id="vardperson_postnummer">{{cert.intygMetadata.skapadAv.vardenhet.postnummer}}</span> <span id="vardperson_postort">{{cert.intygMetadata.skapadAv.vardenhet.postort}}</span></span><br>
                  <span class="text" id="vardperson_telefonnummer">{{cert.intygMetadata.skapadAv.vardenhet.telefonnummer}}</span><br>
                </p>
              </div>

            </div>
            <!-- cert body -->
          </div>
        </div>
      </div>
    </div>
    <!-- entire cert -->
  </div>
  <!--  spinner end -->
</div>
