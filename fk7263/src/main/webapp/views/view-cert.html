<div class="row-fluid">

  <!-- Loading spinner: visibility defined by $scope.doneLoading  -->
  <!-- TODO: Make a directive of this for reuse in all places where we show a spinner? -->
  <div ng-hide="doneLoading" style="text-align: center; padding: 20px;">
    <img src="/img/ajax-loader.gif" style="text-align: center;" />

    <p style="text-align: center; color: #64ABC0; margin-top: 20px;">
      <strong> <message key="view.message.certificateloading" />
      </strong>
    </p>
  </div>

  <div ng-show="doneLoading">

    <div id="backnav" class="row-fluid">
      <a class="backlink" href="/web/start"> <message key="button.goback" />
      </a>
    </div>

    <!-- Content -->
    <div class="row-fluid">
      <div class="span7">
        <h1>
          <message key="view.label.pagetitle" />
        </h1>
        <p>
          <message key="view.label.pagedescription" />
        </p>
        <form id="view-as-pdf" action="/moduleapi/certificate/{{cert.id}}/pdf" method="get" target="_blank">
          <p class="btn-row">
            <button id="sendCertificateBtn" type="button" ng-click="send()" class="btn btn-success">
              <message key="button.send" />
            </button>
            <button id="downloadprint" type="submit" class="btn btn-inverse">
              <message key="button.downloadprint" />
            </button>
          </p>
        </form>
      </div>
      <div class="span5 eventbox">
        <h2>
          <message key="view.label.latestevent"></message>
        </h2>
        <!--  Show if no events to show -->
        <p ng-show="(cert.status | filter: userVisibleStatusFilter).length<1">
              <message key="view.label.latestevent.noevents"></message></a>
        </p>
        
        <!-- Show first status in list if any viable status exist-->
        <p id="lastest-certificate-event" ng-show="(cert.status | filter: userVisibleStatusFilter).length>0">
          {{cert.status[0].timestamp | date:'shortDate'}}
          <message key="fk7263.status.{{cert.status[0].type}}"></message>
          <message key="fk7263.target.{{cert.status[0].target}}"></message>
        </p>
        <!-- Show if more than 1 viable status exists -->
        <p ng-show="(cert.status | filter: userVisibleStatusFilter).length>1">
              <a class="statusHistoryLink" href ng-click="showStatusHistory()"><message key="view.label.latestevent.showall"></message></a>
        </p>
      </div>
    </div>
    <section id="certificate" class="certificate">
      <span class="hide" id="certId" title="{{cert.id}}"></span> <span class="hide" id="certType" title="{{cert.typ}}"></span>

      <div class="row-fluid">
        <div class="span12">
          <div class="cert">
            <div class="cert-titlebar">
              <img class="cert-icon" alt="" ng-src="/img/{{cert.typ}}.png" />

              <div class="row-fluid">
                <div class="span8">
                  <h2>
                    <span><message key="certificatetypes.{{cert.typ}}.commonname" /></span> <span class="cert-titlebar-type"><message key="certificatetypes.{{cert.typ}}.typename" /></span>
                  </h2>
                </div>
                <div class="span3 issue">
                  <span><message key="view.label.issued" /></span> <span class="cert-titlebar-value">{{cert.signeringsDatum | date:'longDate'}}</span>
                </div>
                <div class="span1 archive">
                  <a href="#archiveModal" role="button" data-toggle="modal" onclick="return false"><img alt="Arkivera intyg" src="/img/archive-icon.gif" /></a>
                </div>
              </div>
            </div>

            <div class="cert-header">
              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag"><message key="view.label.patientname" /></h3> <span id="patient-name">{{cert.patient.fullstandigtNamn}}</span>
                </div>
                <div class="span6">
                  <h3 class="tag"><message key="view.label.nedsattning"></message></h3>

                  <div ng-repeat="aktivitetsbegransning in cert.aktivitetsbegransningar">
                    <div ng-repeat="nedsattning in aktivitetsbegransning.arbetsformaga.arbetsformagaNedsattningar">
                      <message key="nedsattningsgrad.{{nedsattning.nedsattningsgrad}}"></message>
                      ({{nedsattning.varaktighetFrom | date:'longDate'}}&ndash;{{nedsattning.varaktighetTom | date:'longDate'}})
                    </div>
                  </div>
                </div>
              </div>

              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag"><message key="view.label.civicnumber" /></h3> <span id="patient-crn">{{cert.patient.id}}</span>
                </div>
                <div class="span6"></div>
              </div>
              <div class="row-fluid">
                <div class="span6 header-row">
                  <h3 class="tag"><message key="view.label.unit" /></h3> <span id="careunit">{{cert.vardenhet.namn}}</span>
                </div>
                <div class="span6">
                  <h3 class="tag"><message key="view.label.issuer" /></h3> <span id="caregiver">{{cert.vardenhet.vardgivare.namn}}</span>
                </div>
              </div>
            </div>

            <div class="cert-body">
              <div class="body-row">
                <h3 class="title"><message key="view.label.smittskydd" /></h3> <span class="text"><message key="view.label.{{smittskydd()}}" /></span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.diagnosis" /></h3> <span class="text">{{cert.bedomtTillstand.beskrivning}} (<span class="tag"><message
                      key="view.label.diagnosisCode" /></span> {{cert.bedomtTillstand.tillstandskod}})
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.progressofdesease" /></h3> <span class="text">{{cert.sjukdomsforlopp}}</span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.disabilities" /></h3> <span ng-repeat="funktionsnedsattning in cert.funktionsnedsattningar" class="text">
                  {{funktionsnedsattning.beskrivning}} </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.basedon" /></h3> <span class="text">
                  <ul>
                    <li ng-repeat="vardkontakt in cert.vardkontakter"><message key="vardkontakt.{{vardkontakt.vardkontakttyp}}"></message> {{vardkontakt.vardkontaktstid | date:'longDate'}}</li>
                    <li ng-repeat="referens in cert.referenser"><message key="referens.{{referens.referenstyp}}" args=""></message> {{referens.datum| date:'longDate'}}

                      <div ng-show="referens.referenstyp == 'ANNAT'">
                        <span class="tag"><message key="view.label.comment"></message></span>{{cert.kommentar}}
                      </div></li>
                  </ul>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.limitation" /></h3> <span ng-repeat="aktivitetsbegransning in cert.aktivitetsbegransningar" class="text">
                  {{aktivitetsbegransning.beskrivning}} </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.recommendations" /></h3> <span class="text">
                  <ul>
                    <li ng-show="cert.rekommenderarKontaktMedArbetsformedlingen != null"><message key="view.label.recommendations.contact.jobcenter" /></li>
                    <li ng-show="cert.rekommenderarKontaktMedForetagshalsovarden != null"><message key="view.label.recommendations.contact.healthdepartment" /></li>
                    <li ng-show="cert.rekommenderarOvrigt != null">{{cert.rekommenderarOvrigt.beskrivning}}</li>
                  </ul>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.plannedtreatment" /></h3> <span class="text">
                  <ul>
                    <li ng-show="cert.atgardInomSjukvarden != null"><message key="view.label.plannedtreatment.healthcare"></message> {{cert.atgardInomSjukvarden.beskrivning}}</li>
                    <li ng-show="cert.annanAtgard != null"><message key="view.label.plannedtreatment.other"></message> {{cert.annanAtgard.beskrivning}}</li>
                  </ul>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.workrehab" /></h3> <span class="text" ng-show="cert.arbetsinriktadRehabiliteringAktuell != null"> <message key="view.label.yes" />
                </span> <span class="text" ng-show="cert.arbetsinriktadRehabiliteringEjAktuell != null"> <message key="view.label.no" />
                </span> <span class="text" ng-show="cert.arbetsinriktadRehabiliteringEjBedombar != null"> <message key="view.label.unjudgeable" />
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.patientworkcapacity" /></h3> <span class="text">
                  <ul>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.sysselsattningar.indexOf('NUVARANDE_ARBETE') != -1"><message key="view.label.patientworkcapacity.currentwork"></message>
                      {{cert.aktivitetsbegransningar[0].arbetsformaga.arbetsuppgift}}</li>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.sysselsattningar.indexOf('ARBETSLOSHET') != -1"><message key="view.label.patientworkcapacity.unemployed" /></li>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.sysselsattningar.indexOf('FORALDRALEDIGHET') != -1"><message key="view.label.patientworkcapacity.parentalleave" /></li>
                  </ul>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.patientworkcapacityjudgement" /></h3> <span class="text">{{cert.aktivitetsbegransningar[0].arbetsformaga.motivering}}</span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.prognosis" /></h3> <span class="text">
                  <ul>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.prognosangivelse.indexOf('ATERSTALLAS_HELT') != -1"><message key="view.label.yes" /></li>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.prognosangivelse.indexOf('ATERSTALLAS_DELVIS') != -1"><message key="view.label.partialyes" /></li>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.prognosangivelse.indexOf('INTE_ATERSTALLAS') != -1"><message key="view.label.no" /></li>
                    <li ng-show="cert.aktivitetsbegransningar[0].arbetsformaga.prognosangivelse.indexOf('DET_GAR_INTE_ATT_BEDOMMA') != -1"><message key="view.label.unjudgeable"></message> <span
                      class="tag"><message key="view.label.comment"></message></span>{{cert.kommentar}}</li>
                  </ul>
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.othertransport" /></h3> <span class="text" ng-show="cert.forandratRessattAktuellt != null"> <message key="view.label.yes" />
                </span> <span class="text" ng-show="cert.forandratRessattEjAktuellt != null"> <message key="view.label.no" />
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.fkcontact" /></h3> <span class="text" ng-show="cert.kontaktMedForsakringskassanAktuell != null"> <message key="view.label.yes" />
                </span>
              </div>

              <div class="body-row">
                <h3 class="title"><message key="view.label.workcodes" /></h3> <span class="text" ng-show="cert.forskrivarkodOchArbetsplatskod != null">{{cert.forskrivarkodOchArbetsplatskod}}</span>
              </div>

              <div class="row-fluid">
                <div class="span7">
                  <div class="infobox">
                    <h3>
                      <message key="view.label.confirmedby" />
                    </h3>
                    <h4>
                      <message key="view.label.date" />
                    </h4>
                    <p>{{cert.signeringsDatum | date:'longDate'}}</p>
                    <h4>
                      <message key="view.label.contactinfo" />
                    </h4>
                    <p>
                      <span class="text">{{cert.skapadAv.namn}}</span><br> <span class="text">{{cert.vardenhet.namn}}</span><br> <span class="text">{{cert.vardenhet.postadress}}</span><br>
                      <span class="text">{{cert.vardenhet.postnummer}} {{cert.vardenhet.postort}}</span><br> <span class="text">{{cert.vardenhet.telefonnummer}}</span><br>
                    </p>
                  </div>
                </div>
              </div>

            </div>
            <!-- cert-body -->

          </div>
        </div>
      </div>
    </section>

  </div>
</div>
