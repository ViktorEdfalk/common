description = 'Intygstyper (FK7263 LÃ¤karintyg)'

// TODO: this list should not be required, copy dependencies whose group is org.webjars instead
List webjars = [[group: 'se.inera.intyg.common', name: 'common-web']]

task unzipWebjars(type: Copy) {
    description 'Copies anything that is a webjar from the classpath and expands it so that we can use their static resources with karma'
    into "$buildDir/webjars/"
    from {
        configurations.compile.filter{ file -> webjars.any{jar -> file.name.startsWith(jar.name) } }.collect{zipTree(it)}
    }
}

task moveJsFiles(type: Copy, dependsOn: unzipWebjars) {
  description 'Moves everything up one level, which gets rid of version directory (angular/1.2.4/* -> angular/)'
  from { "${buildDir}/webjars/META-INF/resources/webjars/" }
  eachFile {details ->
    details.path = details.path.replaceAll('([^/]+)/[0-9.]+(/.*)', '$1$2')
  }
  into "${buildDir}/webjars"
}

task jsTests(type: NodeTask, dependsOn: [npmInstall, moveJsFiles]) {
    script = file('node_modules/grunt-cli/bin/grunt')
    args = ['test', '--outputDir=' + webappTestOutputDir, '--skip-coverage='+(!project.hasProperty('runSonar'))]
}

test.dependsOn(jsTests)

dependencies {
  compile "se.inera.intyg.common:common-support:${commonVersion}"
  compile "se.inera.intyg.common:common-web:${commonVersion}"
  compile "se.inera.intyg.common:integration-util:${commonVersion}"
  compile "se.inera.intyg.common:common-schemas:${commonVersion}"

  compile "com.itextpdf:itextpdf:${itextVersion}"
  compile "commons-collections:commons-collections:${commonsCollectionsVersion}"
  compile "com.helger:ph-schematron:${phSchematronVersion}"
  compile "org.springframework:spring-tx:${springVersion}"
  compile "se.skltp.adapterservices.insuranceprocess.healthreporting:FkEintygAdapterIC-validator:2.2-RC2-INTYG"

  testRuntime 'javax.servlet:servlet-api:2.5'
}

